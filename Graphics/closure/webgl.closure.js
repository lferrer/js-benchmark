var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);for(var e=Math.max(0,Math.min(c|0,b.length)),f=a.length;0<f&&0<e;)if(b[--e]!=a[--f])return!1;return 0>=f}},"es6-impl","es3");var tdl=tdl||{},goog=goog||{};window.Int32Array||(window.Int32Array=function(){},window.Float32Array=function(){},window.Uint16Array=function(){});goog.typedef=!0;tdl.global=this;tdl.BROWSER_ONLY=!0;tdl.provided_=[];
tdl.provide=function(a){if(tdl.getObjectByName(a)&&!tdl.implicitNamespaces_[a])throw'Namespace "'+a+'" already declared.';for(var b=a;b=b.substring(0,b.lastIndexOf("."));)tdl.implicitNamespaces_[b]=!0;tdl.exportPath_(a);tdl.provided_.push(a)};tdl.implicitNamespaces_={};tdl.exportPath_=function(a,b,c){a=a.split(".");c=c||tdl.global;var d;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(;a.length&&(d=a.shift());)!a.length&&tdl.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
tdl.getObjectByName=function(a,b){for(var c=a.split("."),d=b||tdl.global,e=0;e<c.length;++e){var f=c[e];if(d[f])d=d[f];else return null}return d};tdl.require=function(a){document.getElementsByTagName("script");if(!tdl.getObjectByName(a)){var b=tdl.getPathFromRule_(a);if(b)tdl.included_[b]=!0,tdl.writeScripts_();else throw Error("tdl.require could not find: "+a);}};tdl.basePath="";tdl.included_={};tdl.dependencies_={visited:{},written:{}};
tdl.findBasePath_=function(){var a=tdl.global.document;if("undefined"!=typeof a)if(tdl.global.BASE_PATH)tdl.basePath=tdl.global.BASE_PATH;else{tdl.global.BASE_PATH=null;for(var a=a.getElementsByTagName("script"),b,c=0;b=a[c];c++){b=b.src;var d=b.length;if("tdl/base.js"==b.substr(d-11)){tdl.basePath=b.substr(0,d-11);break}}}};
tdl.writeScriptTag_=function(a){var b=tdl.global.document;"undefined"==typeof b||tdl.dependencies_.written[a]||(tdl.dependencies_.written[a]=!0,b.write('<script type="text/javascript" src="'+a+'">\x3c/script>'))};
tdl.writeScripts_=function(){var a=[],b={},c=tdl.dependencies_,d;for(d in tdl.included_)if(!c.written[d]){var e=d;e in c.written||(e in c.visited||(c.visited[e]=!0),e in b||(b[e]=!0,a.push(e)))}for(b=0;b<a.length;b++)if(a[b])tdl.writeScriptTag_(tdl.basePath+a[b]);else throw Error("Undefined script input");};tdl.getPathFromRule_=function(a){return a.split(".").join("/")+".js"};tdl.findBasePath_();tdl.isDef=function(a){return"undefined"!=typeof a};
tdl.exportSymbol=function(a,b,c){tdl.exportPath_(a,b,c)};tdl.provide("tdl.base");tdl.base=tdl.base||{};tdl.base.isArray=function(a){return"object"===typeof a&&null!==a&&"length"in a&&"splice"in a};tdl.base.maybeDeobfuscateFunctionName_=function(a){return a};tdl.base.inherit=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c};
tdl.base.parseErrorStack=function(a){var b=[],c;if(!a||!a.stack)return b;for(var d=a.stack.split("\n"),e=0;e<d.length-1;e++)c=d[e],a=(a=c.match(/^([a-zA-Z0-9_$]*)/)[1])?tdl.base.maybeDeobfuscateFunctionName_(a):"anonymous",(c=(c=c.match(/(.*:[0-9]+)$/))&&c[1])||(c="(unknown)"),b[b.length]=a+" : "+c;for(a=/^anonymous :/;b.length&&a.exec(b[b.length-1]);)--b.length;return b};
tdl.base.getFunctionName=function(a){return(a=a.toString().match(/function(\s*)(\w*)/))&&2<=a.length&&a[2]?tdl.base.maybeDeobfuscateFunctionName_(a[2]):"anonymous"};tdl.base.formatErrorStack=function(a){for(var b="",c=0;c<a.length;c++)b+="> "+a[c]+"\n";return b};
tdl.base.getStackTrace=function(a){var b="";if("undefined"!=typeof arguments.caller)for(var c=arguments.caller;null!=c;c=c.caller){if(b+="> "+tdl.base.getFunctionName(c.callee)+"\n",c.caller==c){b+="*";break}}else try{eval("var var;")}catch(d){c=tdl.base.parseErrorStack(d),b+=tdl.base.formatErrorStack(c.slice(3+a,c.length))}return b};tdl.base.IsMSIE=function(){var a=navigator.userAgent.toLowerCase();return/msie/.test(a)&&!/opera/.test(a)};tdl.provide("tdl.string");tdl.string=tdl.string||{};tdl.string.endsWith=function(a,b){return a.substr(a.length-b.length)===b};tdl.string.startsWith=function(a,b){return a.substr(0,b.length)===b};
tdl.string.argsToString=function(a){for(var b=!1,c=a.length,d=[],e=0;e<c;++e){var f=a[e];void 0===f?d.push("undefined"):"number"==typeof f?(b&&d.push(", "),f==Math.floor(f)?d.push(f.toFixed(0)):d.push(f.toFixed(3)),b=!0):window.Float32Array&&f instanceof Float32Array?d.push(tdl.string.argsToString(f)):(d.push(f.toString()),b=!1)}return d.join("")};
tdl.string.objToString=function(a,b){function c(a,b){b=b||"";if("object"==typeof a)if(void 0!==a.length)for(var e=0;e<a.length;++e)c(a[e],b+"["+e+"]");else for(e in a)c(a[e],b+"."+e);else d.push(tdl.string.argsToString([b,": ",a]))}var d=[];c(a);return d.join("\n")};tdl.provide("tdl.log");tdl.require("tdl.string");tdl.log=tdl.log||{};tdl.log=function(){var a=tdl.string.argsToString(arguments);window.console&&window.console.log?window.console.log(a):window.dump&&window.dump(a+"\n")};tdl.error=function(){var a=tdl.string.argsToString(arguments);window.console?window.console.error?window.console.error(a):window.console.log&&window.console.log(a):window.dump&&window.dump(a+"\n")};tdl.dumpObj=function(a,b){tdl.log(tdl.string.objToString(a,b))};tdl.provide("tdl.misc");tdl.require("tdl.log");tdl.misc=tdl.misc||{};tdl.misc.parseUnquotedJSObjectString=function(a){a=a.replace(/([a-zA-Z0-9_]+):/g,'"$1":');return JSON.parse(a)};
tdl.misc.applyUrlSettings=function(a,b){var c=b||"settings";try{var d=window.location.href,e=d.indexOf("?"),f=d.indexOf("#");0>f&&(f=d.length);for(var g=d.substring(e+1,f).split("&"),d=0;d<g.length;++d){var h=g[d].split("="),k=h[0],l=decodeURIComponent(h[1]);switch(k){case c:var m=tdl.misc.parseUnquotedJSObjectString(l);tdl.misc.copyProperties(m,a)}}}catch(n){tdl.error(n),tdl.error("settings:",m)}};
tdl.misc.copyProperties=function(a,b){for(var c in a){var d=a[c];if(d instanceof Array){var e=b[c];e||(e=[],b[c]=e);tdl.misc.copyProperties(d,e)}else"object"==typeof d?(e=b[c],e||(e={},b[c]=e),tdl.misc.copyProperties(d,e)):b[c]=d}};tdl.provide("tdl.webgl");tdl.require("tdl.log");tdl.require("tdl.misc");tdl.webgl=tdl.webgl||{};gl=null;tdl.webgl.makeCurrent=function(a){gl=a};tdl.webgl.makeFailHTML=function(a){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+a+"</div></div></td></tr></table>"};tdl.webgl.GET_A_WEBGL_BROWSER='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';
tdl.webgl.OTHER_PROBLEM='It does not appear your computer supports WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>';
tdl.webgl.setupWebGL=function(a,b,c){function d(b){var c=a.parentNode;if(c){var d=window.WebGLRenderingContext?tdl.webgl.OTHER_PROBLEM:tdl.webgl.GET_A_WEBGL_BROWSER;b&&(d+="<br/><br/>Status: "+b);c.innerHTML=tdl.webgl.makeFailHTML(d)}}c=c||d;a.addEventListener&&a.addEventListener("webglcontextcreationerror",function(a){c(a.statusMessage)},!1);(b=tdl.webgl.create3DContext(a,b))?a.addEventListener&&(a.addEventListener("webglcontextlost",function(b){b.preventDefault();tdl.webgl.handleContextLost(a)},
!1),a.addEventListener("webglcontextrestored",function(b){tdl.webgl.handleContextRestored(a)},!1)):window.WebGLRenderingContext||c("");return b};
tdl.webgl.create3DContext=function(a,b){void 0===b&&(b={alpha:!1},tdl.misc.applyUrlSettings(b,"webgl"));for(var c=["webgl","experimental-webgl"],d=null,e=0;e<c.length;++e){try{d=a.getContext(c[e],b)}catch(f){}if(d)break}d&&(c=function(){return!1},tdl.webgl.glEnums||tdl.webgl.init(d),tdl.webgl.makeCurrent(d),tdl.webgl.setupCanvas_(a),d.tdl={},d.tdl.depthTexture=tdl.webgl.getExtensionWithKnownPrefixes("WEBGL_depth_texture"),a.onselectstart=c,a.onmousedown=c);return d};
tdl.webgl.setupCanvas_=function(a){a.tdl||(a.tdl={})};tdl.webgl.browserPrefixes_=["","MOZ_","OP_","WEBKIT_"];tdl.webgl.getExtensionWithKnownPrefixes=function(a){for(var b=0;b<tdl.webgl.browserPrefixes_.length;++b){var c=gl.getExtension(tdl.webgl.browserPrefixes_[b]+a);if(c)return c}};tdl.webgl.runHandlers_=function(a){a=a.slice();for(var b=0;b<a.length;++b)a[b]()};
tdl.webgl.registerContextLostHandler=function(a,b,c){tdl.webgl.setupCanvas_(a);a.tdl.contextLostHandlers||(a.tdl.contextLostHandlers=[[],[]]);a.tdl.contextLostHandlers[c?0:1].push(b)};tdl.webgl.registerContextRestoredHandler=function(a,b,c){tdl.webgl.setupCanvas_(a);a.tdl.contextRestoredHandlers||(a.tdl.contextRestoredHandlers=[[],[]]);a.tdl.contextRestoredHandlers[c?0:1].push(b)};
tdl.webgl.handleContextLost=function(a){a.tdl.contextLostHandlers&&(tdl.webgl.runHandlers_(a.tdl.contextLostHandlers[0]),tdl.webgl.runHandlers_(a.tdl.contextLostHandlers[1]))};tdl.webgl.handleContextRestored=function(a){a.tdl.contextRestoredHandlers&&(tdl.webgl.runHandlers_(a.tdl.contextRestoredHandlers[0]),tdl.webgl.runHandlers_(a.tdl.contextRestoredHandlers[1]))};
tdl.webgl.glValidEnumContexts={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},
bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,
3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}};tdl.webgl.glEnums=null;tdl.webgl.init=function(a){if(null==tdl.webgl.glEnums){tdl.webgl.glEnums={};for(var b in a)"number"==typeof a[b]&&(tdl.webgl.glEnums[a[b]]=b)}};
tdl.webgl.checkInit=function(){if(null==tdl.webgl.glEnums)throw"tdl.webgl.init(ctx) not called";};tdl.webgl.mightBeEnum=function(a){tdl.webgl.checkInit();return void 0!==tdl.webgl.glEnums[a]};tdl.webgl.glEnumToString=function(a){tdl.webgl.checkInit();if(void 0===a)return"undefined";var b=tdl.webgl.glEnums[a];return void 0!==b?b:"*UNKNOWN WebGL ENUM (0x"+a.toString(16)+")"};
tdl.webgl.glFunctionArgToString=function(a,b,c){a=tdl.webgl.glValidEnumContexts[a];return void 0!==a&&a[b]?tdl.webgl.glEnumToString(c):null===c?"null":void 0===c?"undefined":c.toString()};tdl.webgl.glFunctionArgsToString=function(a,b){for(var c="",d=0;d<b.length;++d)c+=(0==d?"":", ")+tdl.webgl.glFunctionArgToString(a,d,b[d]);return c};
tdl.webgl.makeDebugContext=function(a,b,c){function d(a,d){return function(){c&&c(d,arguments);try{var e=a[d].apply(a,arguments)}catch(p){throw b(a.NO_ERROR,d,arguments),p;}var g=a.getError();0!=g&&(f[g]=!0,b(g,d,arguments));return e}}function e(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}tdl.webgl.init(a);b=b||function(a,b,c){tdl.error("WebGL error "+tdl.webgl.glEnumToString(a)+" in "+b+"("+tdl.webgl.glFunctionArgsToString(b,c)+")")};var f={},g=
{},h;for(h in a)"function"==typeof a[h]?g[h]=d(a,h):e(g,a,h);g.getError=function(){for(var b in f)if(f[b])return f[b]=!1,b;return a.NO_ERROR};return g};
tdl.webgl.requestAnimationFrame=function(a,b){tdl.webgl.requestAnimationFrameImpl_||(tdl.webgl.requestAnimationFrameImpl_=function(){for(var a=["requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame"],b=0;b<a.length;++b){var e=a[b];if(window[e])return tdl.log("using ",e),function(a){return function(b,c){return window[a].call(window,b,c)}}(e)}tdl.log("using window.setTimeout");return function(a,b){return window.setTimeout(a,
1E3/70)}}());return tdl.webgl.requestAnimationFrameImpl_(a,b)};
tdl.webgl.cancelRequestAnimationFrame=function(a){tdl.webgl.cancelRequestAnimationFrameImpl_||(tdl.webgl.cancelRequestAnimationFrameImpl_=function(){for(var a=["cancelRequestAnimationFrame","webkitCancelRequestAnimationFrame","mozCancelRequestAnimationFrame","oCancelRequestAnimationFrame","msCancelRequestAnimationFrame"],c=0;c<a.length;++c){var d=a[c];if(window[d])return function(a){return function(b){window[a].call(window,b)}}(d)}return function(a){window.clearTimeout(a)}}());tdl.webgl.cancelRequestAnimationFrameImpl_(a)};tdl.provide("tdl.buffers");tdl.buffers=tdl.buffers||{};
tdl.buffers.Buffer=function(a,b){var c=b||gl.ARRAY_BUFFER,d=gl.createBuffer();this.target=c;this.buf=d;this.set(a);this.numComponents_=a.numComponents;this.numElements_=a.numElements;this.totalComponents_=this.numComponents_*this.numElements_;if(a.buffer instanceof Float32Array)this.type_=gl.FLOAT,this.normalize_=!1;else if(a.buffer instanceof Uint8Array)this.type_=gl.UNSIGNED_BYTE,this.normalize_=!0;else if(a.buffer instanceof Int8Array)this.type_=gl.BYTE,this.normalize_=!0;else if(a.buffer instanceof
Uint16Array)this.type_=gl.UNSIGNED_SHORT,this.normalize_=!0;else if(a.buffer instanceof Int16Array)this.type_=gl.SHORT,this.normalize_=!0;else throw"unhandled type:"+typeof a.buffer;};tdl.buffers.Buffer.prototype.set=function(a,b){gl.bindBuffer(this.target,this.buf);gl.bufferData(this.target,a.buffer,b||gl.STATIC_DRAW)};tdl.buffers.Buffer.prototype.setRange=function(a,b){gl.bindBuffer(this.target,this.buf);gl.bufferSubData(this.target,b,a)};tdl.buffers.Buffer.prototype.type=function(){return this.type_};
tdl.buffers.Buffer.prototype.numComponents=function(){return this.numComponents_};tdl.buffers.Buffer.prototype.numElements=function(){return this.numElements_};tdl.buffers.Buffer.prototype.totalComponents=function(){return this.totalComponents_};tdl.buffers.Buffer.prototype.buffer=function(){return this.buf};tdl.buffers.Buffer.prototype.stride=function(){return 0};tdl.buffers.Buffer.prototype.normalize=function(){return this.normalize_};tdl.buffers.Buffer.prototype.offset=function(){return 0};tdl.provide("tdl.fast");tdl.fast=tdl.fast||{};window.Float32Array||(window.Float32Array=function(){});tdl.fast.temp0v3_=new Float32Array(3);tdl.fast.temp1v3_=new Float32Array(3);tdl.fast.temp2v3_=new Float32Array(3);tdl.fast.temp0v4_=new Float32Array(4);tdl.fast.temp1v4_=new Float32Array(4);tdl.fast.temp2v4_=new Float32Array(4);tdl.fast.temp0m4_=new Float32Array(16);tdl.fast.temp1m4_=new Float32Array(16);tdl.fast.temp2m4_=new Float32Array(16);tdl.fast.matrix4=tdl.fast.matrix4||{};
tdl.fast.rowMajor=tdl.fast.rowMajor||{};tdl.fast.columnMajor=tdl.fast.columnMajor||{};tdl.fast.Vector2=goog.typedef;tdl.fast.Vector3=goog.typedef;tdl.fast.Vector4=goog.typedef;tdl.fast.Vector=goog.typedef;tdl.fast.Matrix2=goog.typedef;tdl.fast.Matrix3=goog.typedef;tdl.fast.Matrix4=goog.typedef;tdl.fast.Matrix=goog.typedef;tdl.fast.addVector=function(a,b,c){for(var d=b.length,e=0;e<d;++e)a[e]=b[e]+c[e];return a};tdl.fast.subVector=function(a,b,c){for(var d=b.length,e=0;e<d;++e)a[e]=b[e]-c[e];return a};
tdl.fast.lerpVector=function(a,b,c,d){for(var e=b.length,f=0;f<e;++f)a[f]=(1-d)*b[f]+d*c[f];return a};tdl.fast.divVectorScalar=function(a,b,c){for(var d=b.length,e=0;e<d;++e)a[e]=b[e]/c;return a};tdl.fast.cross=function(a,b,c){a[0]=b[1]*c[2]-b[2]*c[1];a[1]=b[2]*c[0]-b[0]*c[2];a[2]=b[0]*c[1]-b[1]*c[0];return a};tdl.fast.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};
tdl.fast.normalize=function(a,b){for(var c=0,d=b.length,e=0;e<d;++e)c+=b[e]*b[e];c=Math.sqrt(c);if(1E-5<c)for(e=0;e<d;++e)a[e]=b[e]/c;else for(e=0;e<d;++e)a[e]=0;return a};tdl.fast.negativeVector=function(a,b){for(var c=b.length,d=0;d<c;++d)a[d]=-b[d];return a};tdl.fast.negativeMatrix=function(a,b){for(var c=b.length,d=0;d<c;++d)a[d]=-b[d];return a};tdl.fast.copyVector=function(a,b){a.set(b);return a};tdl.fast.copyMatrix=function(a,b){a.set(b);return a};
tdl.fast.mulScalarVector=function(a,b,c){for(var d=c.length,e=0;e<d;++e)a[e]=b*c[e];return a};tdl.fast.mulVectorScalar=function(a,b,c){return tdl.fast.mulScalarVector(a,c,b)};tdl.fast.mulScalarMatrix=function(a,b,c){for(var d=c.length,e=0;e<d;++e)a[e]=b*c[e];return a};tdl.fast.mulMatrixScalar=function(a,b,c){return tdl.fast.mulScalarMatrix(a,c,b)};tdl.fast.mulVectorVector=function(a,b,c){for(var d=b.length,e=0;e<d;++e)a[e]=b[e]*c[e];return a};
tdl.fast.divVectorVector=function(a,b,c){for(var d=b.length,e=0;e<d;++e)a[e]=b[e]/c[e];return a};tdl.fast.rowMajor.mulVectorMatrix4=function(a,b,c){for(var d=0;4>d;++d)for(var e=a[d]=0;4>e;++e)a[d]+=b[e]*c[4*e+d];return a};tdl.fast.columnMajor.mulVectorMatrix4=function(a,b,c){for(var d=0;4>d;++d){a[d]=0;for(var e=4*d,f=0;4>f;++f)a[d]+=b[f]*c[e+f]}return a};tdl.fast.mulVectorMatrix4=null;
tdl.fast.rowMajor.mulMatrix4Vector=function(a,b,c){for(var d=0;4>d;++d){a[d]=0;for(var e=4*d,f=0;4>f;++f)a[d]+=b[e+f]*c[f]}return a};tdl.fast.columnMajor.mulMatrix4Vector=function(a,b,c){for(var d=0;4>d;++d)for(var e=a[d]=0;4>e;++e)a[d]+=c[e]*b[4*e+d];return a};tdl.fast.mulMatrix4Vector=null;
tdl.fast.rowMajor.mulMatrixMatrix3=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],l=b[6],m=b[7];b=b[8];var n=c[0],p=c[1],q=c[2],t=c[3],v=c[4],r=c[5],w=c[6],u=c[7];c=c[8];a[0]=d*n+e*t+f*w;a[1]=d*p+e*v+f*u;a[2]=d*q+e*r+f*c;a[3]=g*n+h*t+k*w;a[4]=g*p+h*v+k*u;a[5]=g*q+h*r+k*c;a[6]=l*n+m*t+b*w;a[7]=l*p+m*v+b*u;a[8]=l*q+m*r+b*c;return a};
tdl.fast.columnMajor.mulMatrixMatrix3=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],l=b[6],m=b[7];b=b[8];var n=c[0],p=c[1],q=c[2],t=c[3],v=c[4],r=c[5],w=c[6],u=c[7];c=c[8];a[0]=d*n+g*p+l*q;a[1]=e*n+h*p+m*q;a[2]=f*n+k*p+b*q;a[3]=d*t+g*v+l*r;a[4]=e*t+h*v+m*r;a[5]=f*t+k*v+b*r;a[6]=d*w+g*u+l*c;a[7]=e*w+h*u+m*c;a[8]=f*w+k*u+b*c;return a};tdl.fast.mulMatrixMatrix3=null;
tdl.fast.rowMajor.mulMatrixMatrix4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],l=b[6],m=b[7],n=b[8],p=b[9],q=b[10],t=b[11],v=b[12],r=b[13],w=b[14];b=b[15];var u=c[0],x=c[1],y=c[2],z=c[3],B=c[4],D=c[5],C=c[6],E=c[7],H=c[8],F=c[9],G=c[10],A=c[11],I=c[12],J=c[13],K=c[14];c=c[15];a[0]=d*u+e*B+f*H+g*I;a[1]=d*x+e*D+f*F+g*J;a[2]=d*y+e*C+f*G+g*K;a[3]=d*z+e*E+f*A+g*c;a[4]=h*u+k*B+l*H+m*I;a[5]=h*x+k*D+l*F+m*J;a[6]=h*y+k*C+l*G+m*K;a[7]=h*z+k*E+l*A+m*c;a[8]=n*u+p*B+q*H+t*I;a[9]=n*x+p*D+q*F+
t*J;a[10]=n*y+p*C+q*G+t*K;a[11]=n*z+p*E+q*A+t*c;a[12]=v*u+r*B+w*H+b*I;a[13]=v*x+r*D+w*F+b*J;a[14]=v*y+r*C+w*G+b*K;a[15]=v*z+r*E+w*A+b*c;return a};
tdl.fast.columnMajor.mulMatrixMatrix4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],k=b[5],l=b[6],m=b[7],n=b[8],p=b[9],q=b[10],t=b[11],v=b[12],r=b[13],w=b[14];b=b[15];var u=c[0],x=c[1],y=c[2],z=c[3],B=c[4],D=c[5],C=c[6],E=c[7],H=c[8],F=c[9],G=c[10],A=c[11],I=c[12],J=c[13],K=c[14];c=c[15];a[0]=d*u+h*x+n*y+v*z;a[1]=e*u+k*x+p*y+r*z;a[2]=f*u+l*x+q*y+w*z;a[3]=g*u+m*x+t*y+b*z;a[4]=d*B+h*D+n*C+v*E;a[5]=e*B+k*D+p*C+r*E;a[6]=f*B+l*D+q*C+w*E;a[7]=g*B+m*D+t*C+b*E;a[8]=d*H+h*F+n*G+v*A;a[9]=e*H+k*F+p*
G+r*A;a[10]=f*H+l*F+q*G+w*A;a[11]=g*H+m*F+t*G+b*A;a[12]=d*I+h*J+n*K+v*c;a[13]=e*I+k*J+p*K+r*c;a[14]=f*I+l*J+q*K+w*c;a[15]=g*I+m*J+t*K+b*c;return a};tdl.fast.mulMatrixMatrix4=null;tdl.fast.rowMajor.column4=function(a,b,c){for(var d=0;4>d;++d)a[d]=b[4*d+c];return a};tdl.fast.columnMajor.column4=function(a,b,c){c*=4;a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2];a[3]=b[c+3];return a};tdl.fast.column4=null;tdl.fast.rowMajor.row4=function(a,b,c){c*=4;a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2];a[3]=b[c+3];return a};
tdl.fast.columnMajor.row4=function(a,b,c){for(var d=0;4>d;++d)a[d]=b[4*d+c];return a};tdl.fast.row4=null;tdl.fast.identity4=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};
tdl.fast.transpose4=function(a,b){if(a===b){var c;c=b[1];b[1]=b[4];b[4]=c;c=b[2];b[2]=b[8];b[8]=c;c=b[3];b[3]=b[12];b[12]=c;c=b[6];b[6]=b[9];b[9]=c;c=b[7];b[7]=b[13];b[13]=c;c=b[11];b[11]=b[14];b[14]=c;return a}c=b[1];var d=b[2],e=b[3],f=b[4],g=b[5],h=b[6],k=b[7],l=b[8],m=b[9],n=b[10],p=b[11],q=b[12],t=b[13],v=b[14],r=b[15];a[0]=b[0];a[1]=f;a[2]=l;a[3]=q;a[4]=c;a[5]=g;a[6]=m;a[7]=t;a[8]=d;a[9]=h;a[10]=n;a[11]=v;a[12]=e;a[13]=k;a[14]=p;a[15]=r;return a};
tdl.fast.inverse4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],k=b[6],l=b[7],m=b[8],n=b[9],p=b[10],q=b[11],t=b[12],v=b[13],r=b[14],w=b[15],u=p*w,x=r*q,y=k*w,z=r*l,B=k*q,D=p*l,C=e*w,E=r*f,H=e*q,F=p*f,G=e*l,A=k*f,I=m*v,J=t*n,K=g*v,L=t*h,M=g*n,N=m*h,O=c*v,P=t*d,Q=c*n,R=m*d,S=c*h,T=g*d,U=u*h+z*n+B*v-(x*h+y*n+D*v),V=x*d+C*n+F*v-(u*d+E*n+H*v),v=y*d+E*h+G*v-(z*d+C*h+A*v),d=D*d+H*h+A*n-(B*d+F*h+G*n),h=1/(c*U+g*V+m*v+t*d);a[0]=h*U;a[1]=h*V;a[2]=h*v;a[3]=h*d;a[4]=h*(x*g+y*m+D*t-(u*g+z*m+B*t));
a[5]=h*(u*c+E*m+H*t-(x*c+C*m+F*t));a[6]=h*(z*c+C*g+A*t-(y*c+E*g+G*t));a[7]=h*(B*c+F*g+G*m-(D*c+H*g+A*m));a[8]=h*(I*l+L*q+M*w-(J*l+K*q+N*w));a[9]=h*(J*f+O*q+R*w-(I*f+P*q+Q*w));a[10]=h*(K*f+P*l+S*w-(L*f+O*l+T*w));a[11]=h*(N*f+Q*l+T*q-(M*f+R*l+S*q));a[12]=h*(K*p+N*r+J*k-(M*r+I*k+L*p));a[13]=h*(Q*r+I*e+P*p-(O*p+R*r+J*e));a[14]=h*(O*k+T*r+L*e-(S*r+K*e+P*k));a[15]=h*(S*p+M*e+R*k-(Q*k+T*p+N*e));return a};tdl.fast.matrix4.inverse=function(a,b){return tdl.fast.inverse4(a,b)};
tdl.fast.matrix4.mul=function(a,b,c){return tdl.fast.mulMatrixMatrix4(a,b,c)};tdl.fast.matrix4.copy=function(a,b){return tdl.fast.copyMatrix(a,b)};tdl.fast.matrix4.setTranslation=function(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};tdl.fast.matrix4.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};tdl.fast.matrix4.identity=function(a){return tdl.fast.identity4(a)};tdl.fast.matrix4.getAxis=function(a,b,c){c*=4;a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2];return a};
tdl.fast.matrix4.perspective=function(a,b,c,d,e){b=Math.tan(.5*Math.PI-.5*b);var f=1/(d-e);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(d+e)*f;a[11]=-1;a[12]=0;a[13]=0;a[14]=d*e*f*2;a[15]=0;return a};tdl.fast.matrix4.ortho=function(a,b,c,d,e,f,g){a[0]=2/(c-b);a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2/(e-d);a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-1/(g-f);a[11]=0;a[12]=(c+b)/(b-c);a[13]=(e+d)/(d-e);a[14]=-f/(f-g);a[15]=1;return a};
tdl.fast.matrix4.frustum=function(a,b,c,d,e,f,g){var h=c-b,k=e-d,l=f-g;a[0]=2*f/h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*f/k;a[6]=0;a[7]=0;a[8]=(b+c)/h;a[9]=(e+d)/k;a[10]=g/l;a[11]=-1;a[12]=0;a[13]=0;a[14]=f*g/l;a[15]=0;return a};
tdl.fast.matrix4.lookAt=function(a,b,c,d){var e=tdl.fast.temp0v3_,f=tdl.fast.temp1v3_,g=tdl.fast.temp2v3_;c=tdl.fast.normalize(e,tdl.fast.subVector(e,b,c));d=tdl.fast.normalize(f,tdl.fast.cross(f,d,c));g=tdl.fast.cross(g,c,d);a[0]=d[0];a[1]=g[0];a[2]=c[0];a[3]=0;a[4]=d[1];a[5]=g[1];a[6]=c[1];a[7]=0;a[8]=d[2];a[9]=g[2];a[10]=c[2];a[11]=0;a[12]=-tdl.fast.dot(d,b);a[13]=-tdl.fast.dot(g,b);a[14]=-tdl.fast.dot(c,b);a[15]=1;return a};
tdl.fast.matrix4.cameraLookAt=function(a,b,c,d){var e=tdl.fast.temp0v3_,f=tdl.fast.temp1v3_,g=tdl.fast.temp2v3_;c=tdl.fast.normalize(e,tdl.fast.subVector(e,b,c));d=tdl.fast.normalize(f,tdl.fast.cross(f,d,c));g=tdl.fast.cross(g,c,d);a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=0;a[4]=g[0];a[5]=g[1];a[6]=g[2];a[7]=0;a[8]=c[0];a[9]=c[1];a[10]=c[2];a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};
tdl.fast.matrix4.translation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};tdl.fast.matrix4.translate=function(a,b){var c=b[0],d=b[1],e=b[2],f=a[1],g=a[2],h=a[3],k=a[5],l=a[6],m=a[7],n=a[9],p=a[10],q=a[11],t=a[13],v=a[14],r=a[15];a[12]=a[0]*c+a[4]*d+a[8]*e+a[12];a[13]=f*c+k*d+n*e+t;a[14]=g*c+l*d+p*e+v;a[15]=h*c+m*d+q*e+r;return a};tdl.fast.matrix4.transpose=tdl.fast.transpose4;
tdl.fast.matrix4.rotationX=function(a,b){var c=Math.cos(b),d=Math.sin(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=d;a[7]=0;a[8]=0;a[9]=-d;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};tdl.fast.matrix4.rotateX=function(a,b){var c=a[4],d=a[5],e=a[6],f=a[7],g=a[8],h=a[9],k=a[10],l=a[11],m=Math.cos(b),n=Math.sin(b);a[4]=m*c+n*g;a[5]=m*d+n*h;a[6]=m*e+n*k;a[7]=m*f+n*l;a[8]=m*g-n*c;a[9]=m*h-n*d;a[10]=m*k-n*e;a[11]=m*l-n*f;return a};
tdl.fast.matrix4.rotationY=function(a,b){var c=Math.cos(b),d=Math.sin(b);a[0]=c;a[1]=0;a[2]=-d;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=d;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};tdl.fast.matrix4.rotateY=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[8],h=a[9],k=a[10],l=a[11],m=Math.cos(b),n=Math.sin(b);a[0]=m*c-n*g;a[1]=m*d-n*h;a[2]=m*e-n*k;a[3]=m*f-n*l;a[8]=m*g+n*c;a[9]=m*h+n*d;a[10]=m*k+n*e;a[11]=m*l+n*f;return a};
tdl.fast.matrix4.rotationZ=function(a,b){var c=Math.cos(b),d=Math.sin(b);a[0]=c;a[1]=d;a[2]=0;a[3]=0;a[4]=-d;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};tdl.fast.matrix4.rotateZ=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=Math.cos(b),n=Math.sin(b);a[0]=m*c+n*g;a[1]=m*d+n*h;a[2]=m*e+n*k;a[3]=m*f+n*l;a[4]=m*g-n*c;a[5]=m*h-n*d;a[6]=m*k-n*e;a[7]=m*l-n*f;return a};
tdl.fast.matrix4.axisRotation=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f=Math.sqrt(d*d+e*e+b*b),d=d/f,e=e/f;b/=f;var f=d*d,g=e*e,h=b*b,k=Math.cos(c);c=Math.sin(c);var l=1-k;a[0]=f+(1-f)*k;a[1]=d*e*l+b*c;a[2]=d*b*l-e*c;a[3]=0;a[4]=d*e*l-b*c;a[5]=g+(1-g)*k;a[6]=e*b*l+d*c;a[7]=0;a[8]=d*b*l+e*c;a[9]=e*b*l-d*c;a[10]=h+(1-h)*k;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};
tdl.fast.matrix4.axisRotate=function(a,b,c){var d=b[0],e=b[1],f=b[2];b=Math.sqrt(d*d+e*e+f*f);d/=b;e/=b;f/=b;b=d*d;var g=e*e,h=f*f,k=Math.cos(c),l=Math.sin(c),m=1-k;c=b+(1-b)*k;b=d*e*m+f*l;var n=d*f*m-e*l,p=d*e*m-f*l,g=g+(1-g)*k,q=e*f*m+d*l,t=d*f*m+e*l,d=e*f*m-d*l,e=h+(1-h)*k,f=a[0],h=a[1],k=a[2],l=a[3],m=a[4],v=a[5],r=a[6],w=a[7],u=a[8],x=a[9],y=a[10],z=a[11];a[0]=c*f+b*m+n*u;a[1]=c*h+b*v+n*x;a[2]=c*k+b*r+n*y;a[3]=c*l+b*w+n*z;a[4]=p*f+g*m+q*u;a[5]=p*h+g*v+q*x;a[6]=p*k+g*r+q*y;a[7]=p*l+g*w+q*z;a[8]=
t*f+d*m+e*u;a[9]=t*h+d*v+e*x;a[10]=t*k+d*r+e*y;a[11]=t*l+d*w+e*z;return a};tdl.fast.matrix4.scaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};tdl.fast.matrix4.scale=function(a,b){var c=b[0],d=b[1],e=b[2];a[0]*=c;a[1]*=c;a[2]*=c;a[3]*=c;a[4]*=d;a[5]*=d;a[6]*=d;a[7]*=d;a[8]*=e;a[9]*=e;a[10]*=e;a[11]*=e;return a};
tdl.fast.installRowMajorFunctions=function(){for(var a in tdl.fast.rowMajor)tdl.fast[a]=tdl.fast.rowMajor[a]};tdl.fast.installColumnMajorFunctions=function(){for(var a in tdl.fast.columnMajor)tdl.fast[a]=tdl.fast.columnMajor[a]};tdl.fast.installRowMajorFunctions();tdl.provide("tdl.fps");tdl.fps=tdl.fps||{};tdl.fps.NUM_FRAMES_TO_AVERAGE=16;tdl.fps.FPSTimer=function(){this.totalTime_=tdl.fps.NUM_FRAMES_TO_AVERAGE;this.timeTable_=[];for(var a=this.timeTableCursor_=0;a<tdl.fps.NUM_FRAMES_TO_AVERAGE;++a)this.timeTable_[a]=1};
tdl.fps.FPSTimer.prototype.update=function(a){this.totalTime_+=a-this.timeTable_[this.timeTableCursor_];this.timeTable_[this.timeTableCursor_]=a;++this.timeTableCursor_;this.timeTableCursor_==tdl.fps.NUM_FRAMES_TO_AVERAGE&&(this.timeTableCursor_=0);this.instantaneousFPS=Math.floor(1/a+.5);this.averageFPS=Math.floor(1/(this.totalTime_/tdl.fps.NUM_FRAMES_TO_AVERAGE)+.5)};tdl.provide("tdl.math");tdl.math=tdl.math||{};tdl.math.randomSeed_=0;tdl.math.RANDOM_RANGE_=Math.pow(2,32);tdl.math.matrix4=tdl.math.matrix4||{};tdl.math.rowMajor=tdl.math.rowMajor||{};tdl.math.columnMajor=tdl.math.columnMajor||{};tdl.math.Vector2=goog.typedef;tdl.math.Vector3=goog.typedef;tdl.math.Vector4=goog.typedef;tdl.math.Vector=goog.typedef;tdl.math.Matrix1=goog.typedef;tdl.math.Matrix2=goog.typedef;tdl.math.Matrix3=goog.typedef;tdl.math.Matrix4=goog.typedef;tdl.math.Matrix=goog.typedef;
tdl.math.pseudoRandom=function(){var a=tdl.math;return(a.randomSeed_=(134775813*a.randomSeed_+1)%a.RANDOM_RANGE_)/a.RANDOM_RANGE_};tdl.math.resetPseudoRandom=function(){tdl.math.randomSeed_=0};tdl.math.randomInt=function(a){return Math.floor(Math.random()*a)};tdl.math.degToRad=function(a){return a*Math.PI/180};tdl.math.radToDeg=function(a){return 180*a/Math.PI};tdl.math.lerpScalar=function(a,b,c){return(1-c)*a+c*b};
tdl.math.addVector=function(a,b){for(var c=[],d=a.length,e=0;e<d;++e)c[e]=a[e]+b[e];return c};tdl.math.subVector=function(a,b){for(var c=[],d=a.length,e=0;e<d;++e)c[e]=a[e]-b[e];return c};tdl.math.lerpVector=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;++f)d[f]=(1-c)*a[f]+c*b[f];return d};tdl.math.modClamp=function(a,b,c){c=c||0;if(1E-5>b)return c;a-=c;a=0>a?a-Math.floor(a/b)*b:a%b;return a+c};
tdl.math.lerpCircular=function(a,b,c,d){a=tdl.math.modClamp(a,d);b=tdl.math.modClamp(b,d);var e=b-a;Math.abs(e)>.5*d&&(b=0<e?b-d:b+d);return tdl.math.modClamp(tdl.math.lerpScalar(a,b,c),d)};tdl.math.lerpRadian=function(a,b,c){return tdl.math.lerpCircular(a,b,c,2*Math.PI)};tdl.math.divVectorScalar=function(a,b){for(var c=[],d=a.length,e=0;e<d;++e)c[e]=a[e]/b;return c};tdl.math.dot=function(a,b){for(var c=0,d=a.length,e=0;e<d;++e)c+=a[e]*b[e];return c};
tdl.math.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};tdl.math.length=function(a){for(var b=0,c=a.length,d=0;d<c;++d)b+=a[d]*a[d];return Math.sqrt(b)};tdl.math.lengthSquared=function(a){for(var b=0,c=a.length,d=0;d<c;++d)b+=a[d]*a[d];return b};tdl.math.distance=function(a,b){for(var c=0,d=a.length,e=0;e<d;++e)var f=a[e]-b[e],c=c+f*f;return Math.sqrt(c)};tdl.math.distanceSquared=function(a,b){for(var c=0,d=a.length,e=0;e<d;++e)var f=a[e]-b[e],c=c+f*f;return c};
tdl.math.normalize=function(a){for(var b=[],c=0,d=a.length,e=0;e<d;++e)c+=a[e]*a[e];c=Math.sqrt(c);if(1E-5<c)for(e=0;e<d;++e)b[e]=a[e]/c;else b=[0,0,0];return b};tdl.math.addMatrix=function(a,b){for(var c=[],d=a.length,e=a[0].length,f=0;f<d;++f){for(var g=[],h=a[f],k=b[f],l=0;l<e;++l)g[l]=h[l]+k[l];c[f]=g}return c};tdl.math.subMatrix=function(a,b){for(var c=[],d=a.length,e=a[0].length,f=0;f<d;++f){for(var g=[],h=a[f],k=b[f],l=0;l<e;++l)g[l]=h[l]-k[l];c[f]=g}return c};
tdl.math.lerpMatrix=function(a,b,c){for(var d=[],e=a.length,f=0;f<e;++f)d[f]=(1-c)*a[f]+c*b[f];return d};tdl.math.divMatrixScalar=function(a,b){for(var c=[],d=a.length,e=0;e<d;++e)c[e]=a[e]/b;return c};tdl.math.negativeScalar=function(a){return-a};tdl.math.negativeVector=function(a){for(var b=[],c=a.length,d=0;d<c;++d)b[d]=-a[d];return b};tdl.math.negativeMatrix=function(a){for(var b=[],c=a.length,d=0;d<c;++d)b[d]=-a[d];return b};tdl.math.copyScalar=function(a){return a};
tdl.math.copyVector=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};tdl.math.copyMatrix=function(a){for(var b=[],c=a.length,d=0;d<c;++d)b[d]=a[d];return b};tdl.math.mulScalarScalar=function(a,b){return a*b};tdl.math.mulScalarVector=function(a,b){for(var c=[],d=b.length,e=0;e<d;++e)c[e]=a*b[e];return c};tdl.math.mulVectorScalar=function(a,b){return tdl.math.mulScalarVector(b,a)};tdl.math.mulScalarMatrix=function(a,b){for(var c=[],d=b.length,e=0;e<d;++e)c[e]=a*b[e];return c};
tdl.math.mulMatrixScalar=function(a,b){return tdl.math.mulScalarMatrix(b,a)};tdl.math.mulVectorVector=function(a,b){for(var c=[],d=a.length,e=0;e<d;++e)c[e]=a[e]*b[e];return c};tdl.math.divVectorVector=function(a,b){for(var c=[],d=a.length,e=0;e<d;++e)c[e]=a[e]/b[e];return c};tdl.math.rowMajor.mulVectorMatrix4=function(a,b){for(var c=[],d=0;4>d;++d)for(var e=c[d]=0;4>e;++e)c[d]+=a[e]*b[4*e+d];return c};
tdl.math.columnMajor.mulVectorMatrix=function(a,b){for(var c=[],d=0;4>d;++d)for(var e=c[d]=0;4>e;++e)c[d]+=a[e]*c[4*d+e];return c};tdl.math.mulVectorMatrix=null;tdl.math.rowMajor.mulMatrixVector=function(a,b){for(var c=[],d=0;4>d;++d)for(var e=c[d]=0;4>e;++e)c[d]+=a[4*d+e]*b[e];return c};tdl.math.columnMajor.mulMatrixVector=function(a,b){for(var c=[],d=0;4>d;++d)for(var e=c[d]=0;4>e;++e)c[d]+=b[e]*a[4*e+d];return c};tdl.math.mulMatrixVector=null;
tdl.math.rowMajor.mulMatrixMatrix2=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],k=b[2],l=b[3];return[c*g+d*k,c*h+d*l,e*g+f*k,e*h+f*l]};tdl.math.columnMajor.mulMatrixMatrix2=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],k=b[2],l=b[3];return[c*g+e*h,d*g+f*h,c*k+e*l,d*k+f*l]};tdl.math.mulMatrixMatrix2=null;
tdl.math.rowMajor.mulMatrixMatrix3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=b[0],p=b[1],q=b[2],t=b[3],v=b[4],r=b[5],w=b[6],u=b[7],x=b[8];return[c*n+d*t+e*w,c*p+d*v+e*u,c*q+d*r+e*x,f*n+g*t+h*w,f*p+g*v+h*u,f*q+g*r+h*x,k*n+l*t+m*w,k*p+l*v+m*u,k*q+l*r+m*x]};
tdl.math.columnMajor.mulMatrixMatrix3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=b[0],p=b[1],q=b[2],t=b[3],v=b[4],r=b[5],w=b[6],u=b[7],x=b[8];return[c*n+f*p+k*q,d*n+g*p+l*q,e*n+h*p+m*q,c*t+f*v+k*r,d*t+g*v+l*r,e*t+h*v+m*r,c*w+f*u+k*x,d*w+g*u+l*x,e*w+h*u+m*x]};tdl.math.mulMatrixMatrix3=null;
tdl.math.rowMajor.mulMatrixMatrix4=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=a[9],p=a[10],q=a[11],t=a[12],v=a[13],r=a[14],w=a[15],u=b[0],x=b[1],y=b[2],z=b[3],B=b[4],D=b[5],C=b[6],E=b[7],H=b[8],F=b[9],G=b[10],A=b[11],I=b[12],J=b[13],K=b[14],L=b[15];return[c*u+d*B+e*H+f*I,c*x+d*D+e*F+f*J,c*y+d*C+e*G+f*K,c*z+d*E+e*A+f*L,g*u+h*B+k*H+l*I,g*x+h*D+k*F+l*J,g*y+h*C+k*G+l*K,g*z+h*E+k*A+l*L,m*u+n*B+p*H+q*I,m*x+n*D+p*F+q*J,m*y+n*C+p*G+q*K,m*z+n*E+p*A+q*L,t*u+v*B+r*H+w*
I,t*x+v*D+r*F+w*J,t*y+v*C+r*G+w*K,t*z+v*E+r*A+w*L]};
tdl.math.columnMajor.mulMatrixMatrix4=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=a[9],p=a[10],q=a[11],t=a[12],v=a[13],r=a[14],w=a[15],u=b[0],x=b[1],y=b[2],z=b[3],B=b[4],D=b[5],C=b[6],E=b[7],H=b[8],F=b[9],G=b[10],A=b[11],I=b[12],J=b[13],K=b[14],L=b[15];return[c*u+g*x+m*y+t*z,d*u+h*x+n*y+v*z,e*u+k*x+p*y+r*z,f*u+l*x+q*y+w*z,c*B+g*D+m*C+t*E,d*B+h*D+n*C+v*E,e*B+k*D+p*C+r*E,f*B+l*D+q*C+w*E,c*H+g*F+m*G+t*A,d*H+h*F+n*G+v*A,e*H+k*F+p*G+r*A,f*H+l*F+q*G+w*A,c*I+g*J+m*
K+t*L,d*I+h*J+n*K+v*L,e*I+k*J+p*K+r*L,f*I+l*J+q*K+w*L]};tdl.math.mulMatrixMatrix4=null;tdl.math.rowMajor.mulMatrixMatrix=function(a,b){for(var c=[],d=0;4>d;++d)for(var e=0;4>e;++e)for(var f=c[4*d+e]=0;4>f;++f)c[4*d+e]+=a[4*d+f]*b[4*f+e];return c};tdl.math.columnMajor.mulMatrixMatrix=function(a,b){for(var c=[],d=0;4>d;++d)for(var e=0;4>e;++e)for(var f=c[4*d+e]=0;4>f;++f)c[4*d+e]+=b[4*d+f]*a[4*f+e];return c};tdl.math.mulMatrixMatrix=null;
tdl.math.rowMajor.column=function(a,b){for(var c=[],d=0;4>d;++d)c[d]=a[4*d+b];return c};tdl.math.columnMajor.column=function(a,b){for(var c=[],d=0;4>d;++d)c[d]=a[4*b+d];return c};tdl.math.column=null;tdl.math.rowMajor.row=function(a,b){for(var c=[],d=0;4>d;++d)c[b]=a[4*b+d];return c};tdl.math.columnMajor.row=function(a,b,c){c=c||4;for(var d=[],e=0;e<c;++e)d[e]=a[e*c+b];return d};tdl.math.row=null;
tdl.math.transpose=function(a){var b=[],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],l=a[8],m=a[9],n=a[10],p=a[11],q=a[12],t=a[13],v=a[14],r=a[15];b[0]=a[0];b[1]=f;b[2]=l;b[3]=q;b[4]=c;b[5]=g;b[6]=m;b[7]=t;b[8]=d;b[9]=h;b[10]=n;b[11]=v;b[12]=e;b[13]=k;b[14]=p;b[15]=r;return b};tdl.math.trace=function(a){for(var b=0,c=0;4>c;++c)b+=a[4*c+c];return b};tdl.math.det1=function(a){return a[0]};tdl.math.det2=function(a){return a[0]*a[3]-a[1]*a[2]};
tdl.math.det3=function(a){return a[8]*(a[0]*a[4]-a[1]*a[3])-a[7]*(a[0]*a[5]-a[2]*a[3])+a[6]*(a[1]*a[5]-a[2]*a[4])};tdl.math.det4=function(a){var b=a[0]*a[5]-a[1]*a[4],c=a[0]*a[6]-a[2]*a[4],d=a[0]*a[7]-a[3]*a[4],e=a[1]*a[6]-a[2]*a[5],f=a[1]*a[7]-a[3]*a[5],g=a[2]*a[7]-a[3]*a[6];return a[15]*(a[10]*b-a[9]*c+a[8]*e)-a[14]*(a[11]*b-a[9]*d+a[8]*f)+a[13]*(a[11]*c-a[10]*d+a[8]*g)-a[12]*(a[11]*e-a[10]*f+a[9]*g)};tdl.math.inverse1=function(a){return[[1/a[0]]]};
tdl.math.inverse2=function(a){var b=1/(a[0]*a[3]-a[1]*a[2]);return[b*a[3],-b*a[1],-b*a[2],b*a[0]]};tdl.math.inverse3=function(a){var b=a[4]*a[8]-a[5]*a[7],c=a[1]*a[8]-a[2]*a[7],d=a[1]*a[5]-a[2]*a[4],e=1/(a[0]*b-a[3]*c+a[6]*d);return[e*b,-e*c,e*d,-e*(a[3]*a[8]-a[5]*a[6]),e*(a[0]*a[8]-a[2]*a[6]),-e*(a[0]*a[5]-a[2]*a[3]),e*(a[3]*a[7]-a[4]*a[6]),-e*(a[0]*a[7]-a[1]*a[6]),e*(a[0]*a[4]-a[1]*a[3])]};
tdl.math.inverse4=function(a){var b=a[10]*a[15],c=a[14]*a[11],d=a[6]*a[15],e=a[14]*a[7],f=a[6]*a[11],g=a[10]*a[7],h=a[2]*a[15],k=a[14]*a[3],l=a[2]*a[11],m=a[10]*a[3],n=a[2]*a[7],p=a[6]*a[3],q=a[8]*a[13],t=a[12]*a[9],v=a[4]*a[13],r=a[12]*a[5],w=a[4]*a[9],u=a[8]*a[5],x=a[0]*a[13],y=a[12]*a[1],z=a[0]*a[9],B=a[8]*a[1],D=a[0]*a[5],C=a[4]*a[1],E=b*a[5]+e*a[9]+f*a[13]-(c*a[5]+d*a[9]+g*a[13]),H=c*a[1]+h*a[9]+m*a[13]-(b*a[1]+k*a[9]+l*a[13]),F=d*a[1]+k*a[5]+n*a[13]-(e*a[1]+h*a[5]+p*a[13]),G=g*a[1]+l*a[5]+p*
a[9]-(f*a[1]+m*a[5]+n*a[9]),A=1/(a[0]*E+a[4]*H+a[8]*F+a[12]*G);return[A*E,A*H,A*F,A*G,A*(c*a[4]+d*a[8]+g*a[12]-(b*a[4]+e*a[8]+f*a[12])),A*(b*a[0]+k*a[8]+l*a[12]-(c*a[0]+h*a[8]+m*a[12])),A*(e*a[0]+h*a[4]+p*a[12]-(d*a[0]+k*a[4]+n*a[12])),A*(f*a[0]+m*a[4]+n*a[8]-(g*a[0]+l*a[4]+p*a[8])),A*(q*a[7]+r*a[11]+w*a[15]-(t*a[7]+v*a[11]+u*a[15])),A*(t*a[3]+x*a[11]+B*a[15]-(q*a[3]+y*a[11]+z*a[15])),A*(v*a[3]+y*a[7]+D*a[15]-(r*a[3]+x*a[7]+C*a[15])),A*(u*a[3]+z*a[7]+C*a[11]-(w*a[3]+B*a[7]+D*a[11])),A*(v*a[10]+u*
a[14]+t*a[6]-(w*a[14]+q*a[6]+r*a[10])),A*(z*a[14]+q*a[2]+y*a[10]-(x*a[10]+B*a[14]+t*a[2])),A*(x*a[6]+C*a[14]+r*a[2]-(D*a[14]+v*a[2]+y*a[6])),A*(D*a[10]+w*a[2]+B*a[6]-(z*a[6]+C*a[10]+u*a[2]))]};tdl.math.codet=function(a,b,c){for(var d=[],e=0,f=0;3>f;++f){e==b&&e++;for(var g=0,h=0;3>h;++h)g==c&&g++,d[4*f+h]=a[4*e+g],g++;e++}return tdl.math.det(d)};tdl.math.det=function(a){return tdl.math.det4(a)};tdl.math.inverse=function(a){return tdl.math.inverse4(a)};tdl.math.orthonormalize=function(a){};
tdl.math.matrix4.inverse=function(a){return tdl.math.inverse4(a)};tdl.math.matrix4.mul=function(a,b){return tdl.math.mulMatrixMatrix4(a,b)};tdl.math.matrix4.det=function(a){return tdl.math.det4(a)};tdl.math.matrix4.copy=function(a){return tdl.math.copyMatrix(a)};tdl.math.matrix4.transpose=tdl.math.transpose;tdl.math.matrix4.setUpper3x3=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[4]=b[3];a[5]=b[4];a[6]=b[5];a[8]=b[6];a[9]=b[7];a[10]=b[8];return a};
tdl.math.matrix4.getUpper3x3=function(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]]};tdl.math.matrix4.setTranslation=function(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};tdl.math.matrix4.getTranslation=function(a){return[a[12],a[13],a[14],a[15]]};tdl.math.matrix4.transformPoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*a[3]+d*a[7]+e*a[11]+a[15];return[(c*a[0]+d*a[4]+e*a[8]+a[12])/f,(c*a[1]+d*a[5]+e*a[9]+a[13])/f,(c*a[2]+d*a[6]+e*a[10]+a[14])/f]};
tdl.math.matrix4.transformVector4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];return[c*a[0]+d*a[4]+e*a[8]+f*a[12],c*a[1]+d*a[5]+e*a[9]+f*a[13],c*a[2]+d*a[6]+e*a[10]+f*a[14],c*a[3]+d*a[7]+e*a[11]+f*a[15]]};tdl.math.matrix4.transformDirection=function(a,b){var c=b[0],d=b[1],e=b[2];return[c*a[0]+d*a[4]+e*a[8],c*a[1]+d*a[5]+e*a[9],c*a[2]+d*a[6]+e*a[10]]};
tdl.math.matrix4.transformNormal=function(a,b){var c=tdl.math.inverse4(a),d=b[0],e=b[1],f=b[2];return[d*c[0]+e*c[1]+f*c[2],d*c[4]+e*c[5]+f*c[6],d*c[8]+e*c[9]+f*c[10]]};tdl.math.matrix4.identity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};tdl.math.matrix4.setIdentity=function(a){for(var b=0;4>b;b++)for(var c=0;4>c;c++)a[4*b+c]=b==c?1:0;return a};tdl.math.matrix4.perspective=function(a,b,c,d){a=Math.tan(.5*Math.PI-.5*a);var e=1/(c-d);return[a/b,0,0,0,0,a,0,0,0,0,(c+d)*e,-1,0,0,c*d*e*2,0]};
tdl.math.matrix4.orthographic=function(a,b,c,d,e,f){return[2/(b-a),0,0,0,0,2/(d-c),0,0,0,0,1/(e-f),0,(a+b)/(a-b),(c+d)/(c-d),e/(e-f),1]};tdl.math.matrix4.frustum=function(a,b,c,d,e,f){var g=b-a,h=d-c,k=e-f;return[2*e/g,0,0,0,0,2*e/h,0,0,(a+b)/g,(d+c)/h,f/k,-1,0,0,e*f/k,0]};tdl.math.matrix4.lookAt=function(a,b,c){return tdl.math.inverse(tdl.math.matrix4.cameraLookAt(a,b,c))};
tdl.math.matrix4.cameraLookAt=function(a,b,c){b=tdl.math.normalize(tdl.math.subVector(a,b));c=tdl.math.normalize(tdl.math.cross(c,b));var d=tdl.math.cross(b,c);return tdl.math.inverse([c[0],c[1],c[2],0,d[0],d[1],d[2],0,b[0],b[1],b[2],0,-tdl.math.dot(c,a),-tdl.math.dot(d,a),-tdl.math.dot(b,a),1])};
tdl.math.matrix4.composition=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=a[9],p=a[10],q=a[11],t=a[12],v=a[13],r=a[14],w=a[15],u=b[0],x=b[1],y=b[2],z=b[3],B=b[4],D=b[5],C=b[6],E=b[7],H=b[8],F=b[9],G=b[10],A=b[11],I=b[12],J=b[13],K=b[14],L=b[15];return[c*u+g*x+m*y+t*z,d*u+h*x+n*y+v*z,e*u+k*x+p*y+r*z,f*u+l*x+q*y+w*z,c*B+g*D+m*C+t*E,d*B+h*D+n*C+v*E,e*B+k*D+p*C+r*E,f*B+l*D+q*C+w*E,c*H+g*F+m*G+t*A,d*H+h*F+n*G+v*A,e*H+k*F+p*G+r*A,f*H+l*F+q*G+w*A,c*I+g*J+m*K+t*L,d*I+
h*J+n*K+v*L,e*I+k*J+p*K+r*L,f*I+l*J+q*K+w*L]};
tdl.math.matrix4.compose=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=a[9],p=a[10],q=a[11],t=a[12],v=a[13],r=a[14],w=a[15],u=b[0],x=b[1],y=b[2],z=b[3],B=b[4],D=b[5],C=b[6],E=b[7],H=b[8],F=b[9],G=b[10],A=b[11],I=b[12],J=b[13],K=b[14],L=b[15];a[0]=c*u+g*x+m*y+t*z;a[1]=d*u+h*x+n*y+v*z;a[2]=e*u+k*x+p*y+r*z;a[3]=f*u+l*x+q*y+w*z;a[4]=c*B+g*D+m*C+t*E;a[5]=d*B+h*D+n*C+v*E;a[6]=e*B+k*D+p*C+r*E;a[7]=f*B+l*D+q*C+w*E;a[8]=c*H+g*F+m*G+t*A;a[9]=d*H+h*F+n*G+v*A;a[10]=e*H+k*
F+p*G+r*A;a[11]=f*H+l*F+q*G+w*A;a[12]=c*I+g*J+m*K+t*L;a[13]=d*I+h*J+n*K+v*L;a[14]=e*I+k*J+p*K+r*L;a[15]=f*I+l*J+q*K+w*L;return a};tdl.math.matrix4.translation=function(a){return[1,0,0,0,0,1,0,0,0,0,1,0,a[0],a[1],a[2],1]};tdl.math.matrix4.translate=function(a,b){var c=a[1],d=a[2],e=a[3],f=a[5],g=a[6],h=a[7],k=a[9],l=a[10],m=a[11],n=a[13],p=a[14],q=a[15],t=b[0],v=b[1],r=b[2];a[12]=a[0]*t+a[4]*v+a[8]*r+a[12];a[13]=c*t+f*v+k*r+n;a[14]=d*t+g*v+l*r+p;a[15]=e*t+h*v+m*r+q;return a};
tdl.math.matrix4.scaling=function(a){return[a[0],0,0,0,0,a[1],0,0,0,0,a[2],0,0,0,0,1]};tdl.math.matrix4.scale=function(a,b){var c=b[0],d=b[1],e=b[2];a[0]*=c;a[1]*=c;a[2]*=c;a[3]*=c;a[4]*=d;a[5]*=d;a[6]*=d;a[7]*=d;a[8]*=e;a[9]*=e;a[10]*=e;a[11]*=e;return a};tdl.math.matrix4.rotationX=function(a){var b=Math.cos(a);a=Math.sin(a);return[1,0,0,0,0,b,a,0,0,-a,b,0,0,0,0,1]};
tdl.math.matrix4.rotateX=function(a,b){var c=a[4],d=a[5],e=a[6],f=a[7],g=a[8],h=a[9],k=a[10],l=a[11],m=Math.cos(b),n=Math.sin(b);a[4]=m*c+n*g;a[5]=m*d+n*h;a[6]=m*e+n*k;a[7]=m*f+n*l;a[8]=m*g-n*c;a[9]=m*h-n*d;a[10]=m*k-n*e;a[11]=m*l-n*f;return a};tdl.math.matrix4.rotationY=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,0,-a,0,0,1,0,0,a,0,b,0,0,0,0,1]};
tdl.math.matrix4.rotateY=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[8],h=a[9],k=a[10],l=a[11],m=Math.cos(b),n=Math.sin(b);a[0]=m*c-n*g;a[1]=m*d-n*h;a[2]=m*e-n*k;a[3]=m*f-n*l;a[8]=m*g+n*c;a[9]=m*h+n*d;a[10]=m*k+n*e;a[11]=m*l+n*f;return a};tdl.math.matrix4.rotationZ=function(a){var b=Math.cos(a);a=Math.sin(a);return[b,a,0,0,-a,b,0,0,0,0,1,0,0,0,0,1]};
tdl.math.matrix4.rotateZ=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=Math.cos(b),n=Math.sin(b);a[0]=m*c+n*g;a[1]=m*d+n*h;a[2]=m*e+n*k;a[3]=m*f+n*l;a[4]=m*g-n*c;a[5]=m*h-n*d;a[6]=m*k-n*e;a[7]=m*l-n*f;return a};tdl.math.matrix4.rotationZYX=function(a){var b=Math.sin(a[0]),c=Math.cos(a[0]),d=Math.sin(a[1]),e=Math.cos(a[1]),f=Math.sin(a[2]);a=Math.cos(a[2]);var g=a*d,h=f*d;return[a*e,f*e,-d,0,g*b-f*c,h*b+a*c,e*b,0,g*c+f*b,h*c-a*b,e*c,0,0,0,0,1]};
tdl.math.matrix4.rotateZYX=function(a,b){var c=Math.sin(b[0]),d=Math.cos(b[0]),e=Math.sin(b[1]),f=Math.cos(b[1]),g=Math.sin(b[2]),h=Math.cos(b[2]),k=h*e,l=g*e,m=h*f,n=g*f,e=-e,p=k*c-g*d,q=l*c+h*d,t=f*c,g=k*d+g*c,c=l*d-h*c,d=f*d,f=a[0],h=a[1],l=a[2],k=a[3],v=a[4],r=a[5],w=a[6],u=a[7],x=a[8],y=a[9],z=a[10],B=a[11];a[0]=m*f+n*v+e*x;a[1]=m*h+n*r+e*y;a[2]=m*l+n*w+e*z;a[3]=m*k+n*u+e*B;a[4]=p*f+q*v+t*x;a[5]=p*h+q*r+t*y;a[6]=p*l+q*w+t*z;a[7]=p*k+q*u+t*B;a[8]=g*f+c*v+d*x;a[9]=g*h+c*r+d*y;a[10]=g*l+c*w+d*z;
a[11]=g*k+c*u+d*B;return a};tdl.math.matrix4.axisRotation=function(a,b){var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e),c=c/f,d=d/f,e=e/f,f=c*c,g=d*d,h=e*e,k=Math.cos(b),l=Math.sin(b),m=1-k;return[f+(1-f)*k,c*d*m+e*l,c*e*m-d*l,0,c*d*m-e*l,g+(1-g)*k,d*e*m+c*l,0,c*e*m+d*l,d*e*m-c*l,h+(1-h)*k,0,0,0,0,1]};
tdl.math.matrix4.axisRotate=function(a,b,c){var d=b[0],e=b[1],f=b[2];b=Math.sqrt(d*d+e*e+f*f);d/=b;e/=b;f/=b;b=d*d;var g=e*e,h=f*f,k=Math.cos(c),l=Math.sin(c),m=1-k;c=b+(1-b)*k;b=d*e*m+f*l;var n=d*f*m-e*l,p=d*e*m-f*l,g=g+(1-g)*k,q=e*f*m+d*l,t=d*f*m+e*l,d=e*f*m-d*l,e=h+(1-h)*k,f=a[0],h=a[1],k=a[2],l=a[3],m=a[4],v=a[5],r=a[6],w=a[7],u=a[8],x=a[9],y=a[10],z=a[11];a[0]=c*f+b*m+n*u;a[1]=c*h+b*v+n*x;a[2]=c*k+b*r+n*y;a[3]=c*l+b*w+n*z;a[4]=p*f+g*m+q*u;a[5]=p*h+g*v+q*x;a[6]=p*k+g*r+q*y;a[7]=p*l+g*w+q*z;a[8]=
t*f+d*m+e*u;a[9]=t*h+d*v+e*x;a[10]=t*k+d*r+e*y;a[11]=t*l+d*w+e*z;return a};tdl.math.installRowMajorFunctions=function(){for(var a in tdl.math.rowMajor)tdl.math[a]=tdl.math.rowMajor[a]};tdl.math.installColumnMajorFunctions=function(){for(var a in tdl.math.columnMajor)tdl.math[a]=tdl.math.columnMajor[a]};tdl.math.installErrorCheckFunctions=function(){for(var a in tdl.math.errorCheck)tdl.math[a]=tdl.math.errorCheck[a]};
tdl.math.installErrorCheckFreeFunctions=function(){for(var a in tdl.math.errorCheckFree)tdl.math[a]=tdl.math.errorCheckFree[a]};tdl.math.installRowMajorFunctions();tdl.math.installErrorCheckFunctions();tdl.provide("tdl.models");tdl.require("tdl.buffers");tdl.models=tdl.models||{};tdl.models.Model=function(a,b,c,d){this.buffers={};this.setBuffers(b);b={};var e=0,f;for(f in a.textures)b[f]=e++;this.mode=void 0===d?gl.TRIANGLES:d;this.textures=c;this.textureUnits=b;this.setProgram(a)};tdl.models.Model.prototype.setProgram=function(a){this.program=a};
tdl.models.Model.prototype.setBuffer=function(a,b,c){var d="indices"==a?gl.ELEMENT_ARRAY_BUFFER:gl.ARRAY_BUFFER,e=this.buffers[a];!e||c?e=new tdl.buffers.Buffer(b,d):e.set(b);this.buffers[a]=e};
tdl.models.Model.prototype.setBuffers=function(a,b){var c=this,d;for(d in a)this.setBuffer(d,a[d],b);if(this.buffers.indices)this.baseBuffer=this.buffers.indices,this.drawFunc=function(a,b){gl.drawElements(c.mode,a,gl.UNSIGNED_SHORT,b)};else{for(var e in this.buffers){this.baseBuffer=this.buffers[e];break}this.drawFunc=function(a,b){gl.drawArrays(c.mode,b,a)}}};tdl.models.Model.prototype.applyUniforms_=function(a){if(a){var b=this.program,c;for(c in a)b.setUniform(c,a[c])}};
tdl.models.Model.prototype.drawPrep=function(){var a=this.program,b=this.buffers,c=this.textures;a.use();for(var d in b){var e=b[d];if("indices"==d)gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,e.buffer());else{var f=a.attrib[d];f&&f(e)}}this.applyUniforms_(c);for(a=0;a<arguments.length;++a)this.applyUniforms_(arguments[a])};
tdl.models.Model.prototype.draw=function(){for(var a=this.buffers,a=a.indices?a.indices.totalComponents():a.position.numElements(),b=0,c=0;c<arguments.length;++c){var d=arguments[c];if("number"==typeof d)switch(c){case 0:a=d;break;case 1:b=d;break;default:throw"unvalid argument";}else this.applyUniforms_(d)}this.drawFunc(a,b)};tdl.provide("tdl.primitives");tdl.require("tdl.math");tdl.require("tdl.log");tdl.primitives=tdl.primitives||{};tdl.primitives.AttribBuffer=function(a,b,c){c=c||"Float32Array";var d=window[c];b.length?(this.buffer=new d(b),this.cursor=b=this.buffer.length/a):(this.buffer=new d(a*b),this.cursor=0);this.numComponents=a;this.numElements=b;this.type=c};tdl.primitives.AttribBuffer.prototype.stride=function(){return 0};tdl.primitives.AttribBuffer.prototype.offset=function(){return 0};
tdl.primitives.AttribBuffer.prototype.getElement=function(a){a*=this.numComponents;for(var b=[],c=0;c<this.numComponents;++c)b.push(this.buffer[a+c]);return b};tdl.primitives.AttribBuffer.prototype.setElement=function(a,b){for(var c=a*this.numComponents,d=0;d<this.numComponents;++d)this.buffer[c+d]=b[d]};tdl.primitives.AttribBuffer.prototype.fillRange=function(a,b,c){a*=this.numComponents;for(var d=0;d<b;++d)for(var e=0;e<this.numComponents;++e)this.buffer[a++]=c[e]};
tdl.primitives.AttribBuffer.prototype.clone=function(){var a=new tdl.primitives.AttribBuffer(this.numComponents,this.numElements,this.type);a.pushArray(this);return a};tdl.primitives.AttribBuffer.prototype.push=function(a){this.setElement(this.cursor++,a)};tdl.primitives.AttribBuffer.prototype.pushArray=function(a){for(var b=0;b<a.numElements;++b)this.push(a.getElement(b))};
tdl.primitives.AttribBuffer.prototype.pushArrayWithOffset=function(a,b){for(var c=0;c<a.numElements;++c){for(var d=a.getElement(c),e=0;e<b.length;++e)d[e]+=b[e];this.push(d)}};tdl.primitives.AttribBuffer.prototype.computeExtents=function(){for(var a=this.numElements,b=this.numComponents,c=this.getElement(0),d=this.getElement(0),e=1;e<a;++e)for(var f=this.getElement(e),g=0;g<b;++g)c[g]=Math.min(c[g],f[g]),d[g]=Math.max(d[g],f[g]);return{min:c,max:d}};
tdl.primitives.mulComponents=function(a,b){for(var c=a.numElements,d=a.numComponents,e=0;e<c;++e){for(var f=a.getElement(e),g=0;g<d;++g)f[g]*=b[g];a.setElement(e,f)}};tdl.primitives.reorientPositions=function(a,b){for(var c=tdl.math,d=a.numElements,e=0;e<d;++e)a.setElement(e,c.matrix4.transformPoint(b,a.getElement(e)))};tdl.primitives.reorientNormals=function(a,b){for(var c=tdl.math,d=a.numElements,e=0;e<d;++e)a.setElement(e,c.matrix4.transformNormal(b,a.getElement(e)))};
tdl.primitives.reorientDirections=function(a,b){for(var c=tdl.math,d=a.numElements,e=0;e<d;++e)a.setElement(e,c.matrix4.transformDirection(b,a.getElement(e)))};tdl.primitives.reorient=function(a,b){for(var c in a)c.match(/^position/)?tdl.primitives.reorientPositions(a[c],b):c.match(/^normal/)?tdl.primitives.reorientNormals(a[c],b):(c.match(/^tangent/)||c.match(/^binormal/))&&tdl.primitives.reorientDirections(a[c],b)};
tdl.primitives.createTangentsAndBinormals=function(a,b,c,d){function e(a){return[Math.round(a[0]),Math.round(a[1]),Math.round(a[2])]}function f(a,b){return e(k.mulVectorScalar(a,100))+","+e(k.mulVectorScalar(b,100))}function g(a,b,c,d){a=f(a,b);(b=l[a])||(b=[[0,0,0],[0,0,0]]);b[0]=k.addVector(b[0],c);b[1]=k.addVector(b[1],d);l[a]=b}function h(a,b){var c=f(a,b);return l[c]}for(var k=tdl.math,l={},m=d.numElements,n=0;n<m;++n){for(var p=d.getElement(n),q=[],t=[],v=[],r=0;3>r;++r){var w=p[r];q[r]=c.getElement(w);
t[r]=a.getElement(w);v[r]=b.getElement(w)}for(var p=[0,0,0],u=[0,0,0],w=0;3>w;++w)r=k.normalize(k.cross([t[1][w]-t[0][w],q[1][0]-q[0][0],q[1][1]-q[0][1]],[t[2][w]-t[0][w],q[2][0]-q[0][0],q[2][1]-q[0][1]])),0==r[0]&&(r[0]=1),p[w]=-r[1]/r[0],u[w]=-r[2]/r[0];q=k.length(p);1E-5<q&&(p=k.mulVectorScalar(p,1/q));q=k.length(u);1E-5<q&&(u=k.mulVectorScalar(u,1/q));for(r=0;3>r;++r)g(t[r],v[r],p,u)}c=a.numElements;d=new tdl.primitives.AttribBuffer(3,c);m=new tdl.primitives.AttribBuffer(3,c);for(w=0;w<c;++w)p=
a.getElement(w),n=b.getElement(w),u=h(p,n),p=u[0],p=k.subVector(p,k.mulVectorScalar(n,k.dot(n,p))),q=k.length(p),1E-5<q&&(p=k.mulVectorScalar(p,1/q)),u=u[1],u=k.subVector(u,k.mulVectorScalar(p,k.dot(p,u))),u=k.subVector(u,k.mulVectorScalar(n,k.dot(n,u))),q=k.length(u),1E-5<q&&(u=k.mulVectorScalar(u,1/q)),d.push(p),m.push(u);return{tangent:d,binormal:m}};
tdl.primitives.addTangentsAndBinormals=function(a){var b=tdl.primitives.createTangentsAndBinormals(a.position,a.normal,a.texCoord,a.indices);a.tangent=b.tangent;a.binormal=b.binormal;return a};tdl.primitives.clone=function(a){var b={},c;for(c in a)b[c]=a[c].clone();return b};
tdl.primitives.concat=function(a){for(var b={},c,d=0;d<a.length;++d){var e=a[d],f;for(f in e){b[f]||(b[f]=[]);c||"indices"==f||(c=f);var g=e[f];b[f].push(g.numElements)}}c=b[c];var h={};for(f in b){for(var b=0,k,l,d=0;d<a.length;++d)e=a[d],g=e[f],b+=g.numElements,k=g.numComponents,l=g.type;for(var b=new tdl.primitives.AttribBuffer(k,b,l),m=0,d=0;d<a.length;++d)e=a[d],g=e[f],"indices"==f?(b.pushArrayWithOffset(g,[m,m,m]),m+=c[d]):b.pushArray(g);h[f]=b}return h};
tdl.primitives.concatLarge=function(a){for(var b=[],c=[],d,e=0,f=0;f<a.length;++f){var g=a[f];!d||65536<e+g.position.numElements?(e=0,d=[g],c.push(d)):d.push(g);b.push({firstVertex:e,numVertices:g.position.numElements,arrayIndex:c.length-1});e+=g.position.numElements}for(f=0;f<c.length;++f)c[f]=tdl.primitives.concat(c[f]);return{arrays:c,instances:b}};
tdl.primitives.applyPlanarUVMapping=function(a,b){for(var c=a.computeExtents(),d=tdl.math.subVector(c.max,c.min),e=a.numElements,f=0;f<e;++f){var g=a.getElement(f);b.setElement(f,[(g[0]-c.min[0])/d[0],(g[2]-c.min[2])/d[2]])}};tdl.primitives.expandInstancesToGeometry=function(a){};
tdl.primitives.createSphere=function(a,b,c,d,e,f,g){if(0>=b||0>=c)throw Error("subdivisionAxis and subdivisionHeight must be > 0");e=e||Math.PI;g=g||2*Math.PI;d=e-(d||0);var h=g-(f||0);e=(b+1)*(c+1);f=new tdl.primitives.AttribBuffer(3,e);g=new tdl.primitives.AttribBuffer(3,e);e=new tdl.primitives.AttribBuffer(2,e);for(var k=0;k<=c;k++)for(var l=0;l<=b;l++){var m=l/b,n=k/c,p=h*m,q=d*n,t=Math.sin(q),v=Math.cos(p)*t,q=Math.cos(q),p=Math.sin(p)*t;f.push([a*v,a*q,a*p]);g.push([v,q,p]);e.push([1-m,n])}a=
b+1;d=new tdl.primitives.AttribBuffer(3,b*c*2,"Uint16Array");for(l=0;l<b;l++)for(k=0;k<c;k++)d.push([(k+0)*a+l,(k+0)*a+l+1,(k+1)*a+l]),d.push([(k+1)*a+l,(k+0)*a+l+1,(k+1)*a+l+1]);return{position:f,normal:g,texCoord:e,indices:d}};
tdl.primitives.createCresent=function(a,b,c,d,e,f,g){function h(b,c,g,h,k,t){for(var r=0;r<=e;r++){var u=c/1,v=r/e,w=2*(u-.5),x=(f+v*m)*Math.PI,F=Math.sin(x),x=Math.cos(x),G=l.lerpScalar(a,b,F);n.push([w*d,x*a,F*G]);w=l.addVector(l.mulVectorVector([0,F,x],g),h);p.push(w);q.push([u*k+t,v])}}function k(a,b){for(var c=0;c<e;++c)v.push([a+c+0,a+c+1,b+c+0]),v.push([a+c+1,b+c+1,b+c+0])}if(0>=e)throw Error("subdivisionDown must be > 0");var l=tdl.math;f=f||0;var m=(g||1)-f;g=8*(e+1);var n=new tdl.primitives.AttribBuffer(3,
g),p=new tdl.primitives.AttribBuffer(3,g),q=new tdl.primitives.AttribBuffer(2,g);for(g=0;2>g;g++){var t=2*(g/1-.5);h(b,g,[1,1,1],[0,0,0],1,0);h(b,g,[0,0,0],[t,0,0],0,0);h(c,g,[1,1,1],[0,0,0],1,0);h(c,g,[0,0,0],[t,0,0],0,1)}var v=new tdl.primitives.AttribBuffer(3,8*e,"Uint16Array");b=e+1;k(0*b,4*b);k(5*b,7*b);k(6*b,2*b);k(3*b,1*b);return{position:n,normal:p,texCoord:q,indices:v}};
tdl.primitives.createPlane=function(a,b,c,d){if(0>=c||0>=d)throw Error("subdivisionWidth and subdivisionDepth must be > 0");for(var e=(c+1)*(d+1),f=new tdl.primitives.AttribBuffer(3,e),g=new tdl.primitives.AttribBuffer(3,e),e=new tdl.primitives.AttribBuffer(2,e),h=0;h<=d;h++)for(var k=0;k<=c;k++){var l=k/c,m=h/d;f.push([a*l-.5*a,0,b*m-.5*b]);g.push([0,1,0]);e.push([l,m])}a=c+1;b=new tdl.primitives.AttribBuffer(3,c*d*2,"Uint16Array");for(h=0;h<d;h++)for(k=0;k<c;k++)b.push([(h+0)*a+k,(h+1)*a+k,(h+0)*
a+k+1]),b.push([(h+1)*a+k,(h+1)*a+k+1,(h+0)*a+k+1]);return{position:f,normal:g,texCoord:e,indices:b}};tdl.primitives.CUBE_FACE_INDICES_=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];
tdl.primitives.createCube=function(a){a/=2;a=[[-a,-a,-a],[+a,-a,-a],[-a,+a,-a],[+a,+a,-a],[-a,-a,+a],[+a,-a,+a],[-a,+a,+a],[+a,+a,+a]];for(var b=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],c=[[1,0],[0,0],[0,1],[1,1]],d=new tdl.primitives.AttribBuffer(3,24),e=new tdl.primitives.AttribBuffer(3,24),f=new tdl.primitives.AttribBuffer(2,24),g=new tdl.primitives.AttribBuffer(3,12,"Uint16Array"),h=0;6>h;++h){for(var k=tdl.primitives.CUBE_FACE_INDICES_[h],l=0;4>l;++l){var m=b[h],n=c[l];d.push(a[k[l]]);
e.push(m);f.push(n)}k=4*h;g.push([k+0,k+1,k+2]);g.push([k+0,k+2,k+3])}return{position:d,normal:e,texCoord:f,indices:g}};
tdl.primitives.createFlaredCube=function(a,b,c){for(var d=2*(c+1),e=new tdl.primitives.AttribBuffer(3,d),f=new tdl.primitives.AttribBuffer(3,d),d=new tdl.primitives.AttribBuffer(2,d),g=new tdl.primitives.AttribBuffer(3,2*c,"Uint16Array"),h=0;h<=c;h++)for(var k=0;1>=k;k++){var l=k,m=h/c,n=tdl.math.lerpScalar(a,b,m);e.push([n*l-.5*n,0,.7*tdl.math.lerpScalar(a,b,m)]);f.push([0,1,0]);d.push([m,l])}for(h=0;h<c;h++)g.push([2*(h+0),2*(h+1),2*(h+0)+1]),g.push([2*(h+1),2*(h+1)+1,2*(h+0)+1]);a={position:e,
normal:f,texCoord:d,indices:g};tdl.primitives.reorient(a,tdl.math.matrix4.rotationX(Math.PI/4));e=[a];for(b=0;3>b;++b)c=tdl.primitives.clone(a),tdl.primitives.reorient(c,tdl.math.matrix4.rotationZ(Math.PI*(b+1)/2)),e.push(c);a=tdl.primitives.concat(e);e=[a];for(b=0;3>b;++b)c=tdl.primitives.clone(a),tdl.primitives.reorient(c,tdl.math.matrix4.rotationY(Math.PI*(b+1)/2)),e.push(c);return a=tdl.primitives.concat(e)};
tdl.primitives.createTruncatedCone=function(a,b,c,d,e,f,g){if(3>d)throw Error("radialSubdivisions must be 3 or greater");if(1>e)throw Error("verticalSubdivisions must be 1 or greater");var h=void 0===f?!0:f,k=void 0===g?!0:g;g=(h?2:0)+(k?2:0);var l=(d+1)*(e+1+g);f=new tdl.primitives.AttribBuffer(3,l);for(var m=new tdl.primitives.AttribBuffer(3,l),l=new tdl.primitives.AttribBuffer(2,l),n=new tdl.primitives.AttribBuffer(3,d*(e+g)*2,"Uint16Array"),p=d+1,q=Math.atan2(a-b,c),t=Math.cos(q),q=Math.sin(q),
k=e+(k?2:0),h=h?-2:0;h<=k;++h){var v=h/e,r=c*v,w;0>h?(r=0,v=1,w=a):h>e?(r=c,v=1,w=b):w=a+h/e*(b-a);if(-2==h||h==e+2)v=w=0;for(var r=r-c/2,u=0;u<p;++u){var x=Math.sin(u*Math.PI*2/d),y=Math.cos(u*Math.PI*2/d);f.push([x*w,r,y*w]);m.push([0>h||h>e?0:x*t,0>h?-1:h>e?1:q,0>h||h>e?0:y*t]);l.push([u/d,1-v])}}for(h=0;h<e+g;++h)for(u=0;u<d;++u)n.push([p*(h+0)+0+u,p*(h+0)+1+u,p*(h+1)+1+u]),n.push([p*(h+0)+0+u,p*(h+1)+1+u,p*(h+1)+0+u]);return{position:f,normal:m,texCoord:l,indices:n}};
tdl.primitives.createCylinder=function(a,b,c,d,e,f){return tdl.primitives.createTruncatedCone(a,a,b,c,d,e,f)};
tdl.primitives.createTorus=function(a,b,c,d,e,f){if(3>c)throw Error("radialSubdivisions must be 3 or greater");if(3>d)throw Error("verticalSubdivisions must be 3 or greater");var g=e||0,h=(f||2*Math.PI)-g,k=c*d;f=new tdl.primitives.AttribBuffer(3,k);e=new tdl.primitives.AttribBuffer(3,k);for(var k=new tdl.primitives.AttribBuffer(2,k),l=new tdl.primitives.AttribBuffer(3,c*d*2,"Uint16Array"),m=0;m<d;++m)for(var n=m/d,p=n*Math.PI*2,q=Math.sin(p),t=a+q*b,v=Math.cos(p),r=v*b,p=0;p<c;++p){var w=p/c,u=g+
w*h,x=Math.sin(u),u=Math.cos(u),y=x*q,z=u*q;f.push([x*t,r,u*t]);e.push([y,v,z]);k.push([w,1-n])}for(m=0;m<d;++m)for(p=0;p<c;++p)a=(1+p)%c,b=(1+m)%d,l.push([c*m+p,c*b+p,c*m+a]),l.push([c*b+p,c*b+a,c*m+a]);return{position:f,normal:e,texCoord:k,indices:l}};
tdl.primitives.createDisc=function(a,b,c,d,e){if(3>b)throw Error("divisions must be at least 3");c=c?c:1;e=e?e:1;d=d?d:0;var f=b*(c+1),g=new tdl.primitives.AttribBuffer(3,f),h=new tdl.primitives.AttribBuffer(3,f),f=new tdl.primitives.AttribBuffer(2,f),k=new tdl.primitives.AttribBuffer(3,c*b*2,"Uint16Array"),l=0;a-=d;for(var m=0;m<=c;++m){for(var n=d+a*Math.pow(m/c,e),p=0;p<b;++p){var q=2*Math.PI*p/b;g.push([n*Math.cos(q),0,n*Math.sin(q)]);h.push([0,1,0]);f.push([1-p/b,m/c]);if(0<m){var q=l+(p+1)%
b,t=l+p-b,v=l+(p+1)%b-b;k.push([q,l+p,t]);k.push([q,t,v])}}l+=b}return{position:g,normal:h,texCoord:f,indices:k}};tdl.primitives.interleaveVertexData=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].numComponents;for(var c=a[0].numElements,b=new Float32Array(b*c),d=0,e=0;e<c;e++)for(var f=0;f<a.length;f++)for(var g=a[f].getElement(e),h=0;h<a[f].numComponents;h++)b[d++]=g[h];return b};tdl.provide("tdl.programs");tdl.require("tdl.log");tdl.require("tdl.string");tdl.require("tdl.webgl");tdl.programs=tdl.programs||{};tdl.programs.loadProgramFromScriptTags=function(a,b){var c=document.getElementById(a),d=document.getElementById(b);if(!c)throw"Can't find vertex program tag: "+a;if(!d)throw"Can't find fragment program tag: "+b;return tdl.programs.loadProgram(document.getElementById(a).text,document.getElementById(b).text)};tdl.programs.makeProgramId=function(a,b){return a+b};
tdl.programs.loadProgram=function(a,b,c){var d=tdl.programs.makeProgramId(a,b);tdl.programs.init_();var e=gl.tdl.programs.programDB[d];if(e)return c&&setTimeout(function(){c()},1),e;try{e=new tdl.programs.Program(a,b,c)}catch(f){return tdl.error(f),null}c||(gl.tdl.programs.programDB[d]=e);return e};
tdl.programs.Program=function(a,b,c){function d(a){function b(a,b){if(1!=a.size)throw"arrays of attribs not handled";return function(a){gl.bindBuffer(gl.ARRAY_BUFFER,a.buffer());gl.enableVertexAttribArray(b);gl.vertexAttribPointer(b,a.numComponents(),a.type(),a.normalize(),a.stride(),a.offset())}}function c(b){var c=gl.getUniformLocation(a,b.name),d=b.type;if(1<b.size&&tdl.string.endsWith(b.name,"[0]")){if(d==gl.FLOAT)return function(){var a;return function(b){b!==a&&(a=b,gl.uniform1fv(c,b))}}();
if(d==gl.FLOAT_VEC2)return function(){var a=new Float32Array([-1,-1]);return function(b){b[0]==a[0]&&b[1]==a[1]||gl.uniform2fv(c,b)}}();if(d==gl.FLOAT_VEC3)return function(){var a=new Float32Array([-1,-1,-1]);return function(b){b[0]==a[0]&&b[1]==a[1]&&b[2]==a[2]||gl.uniform3fv(c,b)}}();if(d==gl.FLOAT_VEC4)return function(a){gl.uniform4fv(c,a)};if(d==gl.INT)return function(a){gl.uniform1iv(c,a)};if(d==gl.INT_VEC2)return function(a){gl.uniform2iv(c,a)};if(d==gl.INT_VEC3)return function(a){gl.uniform3iv(c,
a)};if(d==gl.INT_VEC4)return function(a){gl.uniform4iv(c,a)};if(d==gl.BOOL)return function(a){gl.uniform1iv(c,a)};if(d==gl.BOOL_VEC2)return function(a){gl.uniform2iv(c,a)};if(d==gl.BOOL_VEC3)return function(a){gl.uniform3iv(c,a)};if(d==gl.BOOL_VEC4)return function(a){gl.uniform4iv(c,a)};if(d==gl.FLOAT_MAT2)return function(a){gl.uniformMatrix2fv(c,!1,a)};if(d==gl.FLOAT_MAT3)return function(a){gl.uniformMatrix3fv(c,!1,a)};if(d==gl.FLOAT_MAT4)return function(a){gl.uniformMatrix4fv(c,!1,a)};if(d==gl.SAMPLER_2D||
d==gl.SAMPLER_CUBE){for(var d=[],e=0;e<b.size;++e)d.push(n++);return function(a){return function(b){gl.uniform1iv(c,a);b.bindToUnit(a)}}(d)}}else{if(d==gl.FLOAT)return function(a){gl.uniform1f(c,a)};if(d==gl.FLOAT_VEC2)return function(a){gl.uniform2fv(c,a)};if(d==gl.FLOAT_VEC3)return function(a){gl.uniform3fv(c,a)};if(d==gl.FLOAT_VEC4)return function(a){gl.uniform4fv(c,a)};if(d==gl.INT)return function(a){gl.uniform1i(c,a)};if(d==gl.INT_VEC2)return function(a){gl.uniform2iv(c,a)};if(d==gl.INT_VEC3)return function(a){gl.uniform3iv(c,
a)};if(d==gl.INT_VEC4)return function(a){gl.uniform4iv(c,a)};if(d==gl.BOOL)return function(a){gl.uniform1i(c,a)};if(d==gl.BOOL_VEC2)return function(a){gl.uniform2iv(c,a)};if(d==gl.BOOL_VEC3)return function(a){gl.uniform3iv(c,a)};if(d==gl.BOOL_VEC4)return function(a){gl.uniform4iv(c,a)};if(d==gl.FLOAT_MAT2)return function(a){gl.uniformMatrix2fv(c,!1,a)};if(d==gl.FLOAT_MAT3)return function(a){gl.uniformMatrix3fv(c,!1,a)};if(d==gl.FLOAT_MAT4)return function(a){gl.uniformMatrix4fv(c,!1,a)};if(d==gl.SAMPLER_2D||
d==gl.SAMPLER_CUBE)return function(a){return function(b){gl.uniform1i(c,a);b.bindToUnit(a)}}(n++)}throw"unknown type: 0x"+d.toString(16);}for(var d={},f={},g=gl.getProgramParameter(a,gl.ACTIVE_ATTRIBUTES),h=0;h<g;++h){var k=gl.getActiveAttrib(a,h);if(!k)break;var l=k.name;tdl.string.endsWith(l,"[0]")&&(l=l.substr(0,l.length-3));var m=gl.getAttribLocation(a,k.name);d[l]=b(k,m);f[l]=m}for(var g=gl.getProgramParameter(a,gl.ACTIVE_UNIFORMS),m={},n=0,q={},h=0;h<g;++h){k=gl.getActiveUniform(a,h);if(!k)break;
l=k.name;tdl.string.endsWith(l,"[0]")&&(l=l.substr(0,l.length-3));var p=c(k);m[l]=p;if(k.type==gl.SAMPLER_2D||k.type==gl.SAMPLER_CUBE)q[l]=p}e.textures=q;e.attrib=d;e.attribLoc=f;e.uniform=m}var e=this;this.programId=tdl.programs.makeProgramId(a,b);this.asyncCallback=c;var f,g,h,k,l=function(a,b,c){f=b+c;tdl.programs.init_();var d=a.tdl.programs.shaderDB[f];if(d)return d;d=a.createShader(c);a.shaderSource(d,b);a.compileShader(d);e.asyncCallback||m(d);return d},m=function(a){if(!gl.getShaderParameter(a,
gl.COMPILE_STATUS)&&!gl.isContextLost())throw tdl.programs.lastError=gl.getShaderInfoLog(a),gl.deleteShader(a),"*** Error compiling shader :"+tdl.programs.lastError;gl.tdl.programs.shaderDB[f]=a},n=function(a,b,c){try{h=l(a,b,a.VERTEX_SHADER),k=l(a,c,a.FRAGMENT_SHADER),g=a.createProgram(),a.attachShader(g,h),a.attachShader(g,k),b=g,a.linkProgram(b),e.asyncCallback||p(b)}catch(r){throw h&&gl.deleteShader(h),k&&gl.deleteShader(k),g&&gl.deleteProgram(g),r;}return g},p=function(a){if(!gl.getProgramParameter(a,
gl.LINK_STATUS)&&!gl.isContextLost())throw tdl.programs.lastError=gl.getProgramInfoLog(a),"*** Error in program linking:"+tdl.programs.lastError;};g=n(gl,a,b);if(!g&&!gl.isContextLost())throw"could not compile program";d(g);this.loadNewShaders=function(a,b){var c=n(gl,a,b);if(!c&&!gl.isContextLost())throw"could not compile program";e.program=c;d()};this.program=g;this.good=this.asyncCallback?!1:!0;this.asyncCallback&&setTimeout(function(){try{m(h),m(k),p(g)}catch(q){e.asyncCallback(q.toString());
return}gl.tdl.programs.programDB[e.programId]=this;e.asyncCallback()},1E3)};tdl.programs.handleContextLost_=function(){gl.tdl&&gl.tdl.programs&&gl.tdl.programs.shaderDB&&(delete gl.tdl.programs.shaderDB,delete gl.tdl.programs.programDB)};tdl.programs.init_=function(){gl.tdl.programs||(gl.tdl.programs={},tdl.webgl.registerContextLostHandler(gl.canvas,tdl.programs.handleContextLost_,!0));gl.tdl.programs.shaderDB||(gl.tdl.programs.shaderDB={},gl.tdl.programs.programDB={})};
tdl.programs.Program.prototype.use=function(){gl.useProgram(this.program)};tdl.programs.Program.prototype.setUniform=function(a,b){var c=this.uniform[a];c&&c(b)};tdl.provide("tdl.textures");tdl.require("tdl.webgl");tdl.textures=tdl.textures||{};
tdl.textures.loadTexture=function(a,b,c){var d;if("string"==typeof a)td=a;else if(4==a.length&&"number"==typeof a[0])d=a.toString();else if(1!=a.length&&6!=a.length||"string"!=typeof a[0])if("CANVAS"==a.tagName)d=void 0;else if("IMG"==a.tagName)d=a.src;else if(a.width)d=void 0;else throw"bad args";else d=a.toString();var e;tdl.textures.init_(gl);void 0!==d&&(e=gl.tdl.textures.db[d]);if(e)return e;if("string"==typeof a)e=new tdl.textures.Texture2D(a,b,c);else if(4==a.length&&"number"==typeof a[0])e=
new tdl.textures.SolidTexture(a);else if(1!=a.length&&6!=a.length||"string"!=typeof a[0])if("CANVAS"==a.tagName||"IMG"==a.tagName)e=new tdl.textures.Texture2D(a,b);else if(a.width)e=new tdl.textures.ColorTexture2D(a);else throw"bad args";else e=new tdl.textures.CubeMap(a);return gl.tdl.textures.db[a.toString()]=e};tdl.textures.addLoadingImage_=function(a){tdl.textures.init_(gl);gl.tdl.textures.loadingImages.push(a)};
tdl.textures.removeLoadingImage_=function(a){gl.tdl.textures.loadingImages.splice(gl.tdl.textures.loadingImages.indexOf(a),1)};
tdl.textures.init_=function(a){a.tdl.textures||(a.tdl.textures={},a.tdl.textures.loadingImages=[],tdl.webgl.registerContextLostHandler(a.canvas,tdl.textures.handleContextLost_,!0));a.tdl.textures.maxTextureSize||(a.tdl.textures.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),a.tdl.textures.maxCubeMapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE));a.tdl.textures.db||(a.tdl.textures.db={})};
tdl.textures.handleContextLost_=function(){if(gl.tdl&&gl.tdl.textures){delete gl.tdl.textures.db;for(var a=gl.tdl.textures.loadingImages,b=0;b<a.length;++b)a[b].onload=void 0;gl.tdl.textures.loadingImages=[]}};tdl.textures.Texture=function(a){this.target=a;this.texture=gl.createTexture();this.params={}};tdl.textures.Texture.prototype.setParameter=function(a,b){this.params[a]=b;gl.bindTexture(this.target,this.texture);gl.texParameteri(this.target,a,b)};
tdl.textures.Texture.prototype.recoverFromLostContext=function(){this.texture=gl.createTexture();gl.bindTexture(this.target,this.texture);for(var a in this.params)gl.texParameteri(this.target,a,this.params[a])};tdl.textures.SolidTexture=function(a){tdl.textures.Texture.call(this,gl.TEXTURE_2D);this.color=a.slice(0,4);this.uploadTexture()};tdl.base.inherit(tdl.textures.SolidTexture,tdl.textures.Texture);
tdl.textures.SolidTexture.prototype.uploadTexture=function(){gl.bindTexture(gl.TEXTURE_2D,this.texture);var a=new Uint8Array(this.color);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,a)};tdl.textures.SolidTexture.prototype.recoverFromLostContext=function(){tdl.textures.Texture.recoverFromLostContext.call(this);this.uploadTexture()};tdl.textures.SolidTexture.prototype.bindToUnit=function(a){gl.activeTexture(gl.TEXTURE0+a);gl.bindTexture(gl.TEXTURE_2D,this.texture)};
tdl.textures.DepthTexture=function(a,b){if(!gl.tdl.depthTexture)throw"depth textures not supported";tdl.textures.Texture.call(this,gl.TEXTURE_2D);this.width=a;this.height=b;this.uploadTexture()};tdl.base.inherit(tdl.textures.DepthTexture,tdl.textures.Texture);
tdl.textures.DepthTexture.prototype.uploadTexture=function(){gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.DEPTH_COMPONENT,this.width,this.height,0,gl.DEPTH_COMPONENT,gl.UNSIGNED_INT,null);this.setParameter(gl.TEXTURE_MIN_FILTER,gl.NEAREST);this.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST);this.setParameter(gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);this.setParameter(gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)};
tdl.textures.DepthTexture.prototype.recoverFromLostContext=function(){tdl.textures.Texture.recoverFromLostContext.call(this);this.uploadTexture()};tdl.textures.DepthTexture.prototype.bindToUnit=function(a){gl.activeTexture(gl.TEXTURE0+a);gl.bindTexture(gl.TEXTURE_2D,this.texture)};tdl.textures.ColorTexture=function(a,b,c){tdl.textures.Texture.call(this,gl.TEXTURE_2D);this.format=b||gl.RGBA;this.type=c||gl.UNSIGNED_BYTE;a.pixels instanceof Array&&(a.pixels=new Uint8Array(a.pixels));this.data=a;this.uploadTexture()};
tdl.base.inherit(tdl.textures.ColorTexture,tdl.textures.Texture);tdl.textures.ColorTexture.prototype.uploadTexture=function(){gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1);gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.data.width,this.data.height,0,this.format,this.type,this.data.pixels)};tdl.textures.ColorTexture.prototype.recoverFromLostContext=function(){tdl.textures.Texture.recoverFromLostContext.call(this);this.uploadTexture()};
tdl.textures.ColorTexture.prototype.bindToUnit=function(a){gl.activeTexture(gl.TEXTURE0+a);gl.bindTexture(gl.TEXTURE_2D,this.texture)};
tdl.textures.Texture2D=function(a,b,c){tdl.textures.Texture.call(this,gl.TEXTURE_2D);this.flipY=b||!1;var d=this,e;"string"!==typeof a?(e=a,this.loaded=!0,c&&c()):(e=document.createElement("img"),tdl.textures.addLoadingImage_(e),e.onload=function(){tdl.textures.removeLoadingImage_(e);d.updateTexture();c&&c()},e.onerror=function(){tdl.log("could not load image: ",a)});this.img=e;this.uploadTexture();this.loaded||(e.src=a)};tdl.base.inherit(tdl.textures.Texture2D,tdl.textures.Texture);
tdl.textures.isPowerOf2=function(a){return 0==(a&a-1)};tdl.textures.Texture2D.prototype.uploadTexture=function(){gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);if(this.loaded)gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.setTexture(this.img);else{var a=new Uint8Array([255,255,255,255]);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,a)}};
tdl.textures.Texture2D.prototype.setTexture=function(a){gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a);tdl.textures.isPowerOf2(a.width)&&tdl.textures.isPowerOf2(a.height)?(this.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(gl.TEXTURE_2D)):(this.setParameter(gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),this.setParameter(gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),this.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR))};
tdl.textures.Texture2D.prototype.updateTexture=function(){this.loaded=!0;this.uploadTexture()};tdl.textures.Texture2D.prototype.recoverFromLostContext=function(){tdl.textures.Texture.recoverFromLostContext.call(this);this.uploadTexture()};tdl.textures.Texture2D.prototype.bindToUnit=function(a){gl.activeTexture(gl.TEXTURE0+a);gl.bindTexture(gl.TEXTURE_2D,this.texture)};tdl.textures.ExternalTexture=function(a){tdl.textures.Texture.call(this,a);this.type=a};
tdl.base.inherit(tdl.textures.ExternalTexture,tdl.textures.Texture);tdl.textures.ExternalTexture.prototype.recoverFromLostContext=function(){};tdl.textures.ExternalTexture.prototype.bindToUnit=function(a){gl.activeTexture(gl.TEXTURE0+a);gl.bindTexture(this.type,this.texture)};tdl.textures.ExternalTexture2D=function(){tdl.textures.ExternalTexture.call(this,gl.TEXTURE_2D)};tdl.base.inherit(tdl.textures.ExternalTexture2D,tdl.textures.ExternalTexture);
tdl.textures.CubeMap=function(a){tdl.textures.init_(gl);tdl.textures.Texture.call(this,gl.TEXTURE_CUBE_MAP);tdl.textures.CubeMap.faceTargets||(tdl.textures.CubeMap.faceTargets=[gl.TEXTURE_CUBE_MAP_POSITIVE_X,gl.TEXTURE_CUBE_MAP_NEGATIVE_X,gl.TEXTURE_CUBE_MAP_POSITIVE_Y,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,gl.TEXTURE_CUBE_MAP_POSITIVE_Z,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z],tdl.textures.CubeMap.offsets=[[2,1],[0,1],[1,0],[1,2],[1,1],[3,1]]);gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.texture);this.setParameter(gl.TEXTURE_MAG_FILTER,
gl.LINEAR);this.setParameter(gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);this.setParameter(gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);this.faces=[];if(a.length){this.numUrls=a.length;for(var b=this,c=0;c<a.length;++c){var d={};this.faces[c]=d;var e=document.createElement("img");tdl.textures.addLoadingImage_(e);d.img=e;e.onload=function(c){return function(){tdl.textures.removeLoadingImage_(e);tdl.log("loaded image: ",a[c]);b.updateTexture(c)}}(c);e.onerror=function(a){return function(){tdl.log("could not load image: ",
a)}}(a[c]);e.src=a[c]}}else this.numUrls=0,this.size=a;this.uploadTextures()};tdl.base.inherit(tdl.textures.CubeMap,tdl.textures.Texture);tdl.textures.CubeMap.prototype.loaded=function(){for(var a=0;a<this.faces.length;++a)if(!this.faces[a].loaded)return!1;return!0};
tdl.textures.clampToMaxSize=function(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),c=Math.floor(a.height*b/c),e=document.createElement("canvas");e.width=d;e.height=c;e.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d,c);return e};
tdl.textures.CubeMap.prototype.uploadTextures=function(){for(var a=this.loaded(),b=tdl.textures.CubeMap.faceTargets,c=0;6>c;++c){var d=!1,e=b[c];if(this.faces.length){var f=this.faces[Math.min(this.faces.length-1,c)];gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.texture);if(a){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1);if(6==this.faces.length)gl.texImage2D(e,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,tdl.textures.clampToMaxSize(f.img,gl.tdl.textures.maxCubeMapSize));else{var d=document.createElement("canvas"),g=
f.img.width/4,h=f.img.height/3;d.width=g;d.height=h;d.getContext("2d").drawImage(f.img,tdl.textures.CubeMap.offsets[c][0]*g,tdl.textures.CubeMap.offsets[c][1]*h,g,h,0,0,g,h);gl.texImage2D(e,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,tdl.textures.clampToMaxSize(d,gl.tdl.textures.maxCubeMapSize))}d=!0}}d||(f=new Uint8Array([100,100,255,255]),gl.texImage2D(e,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,f))}a=!1;this.faces.length&&(a=this.faces[0].img,a=6==this.faces.length?tdl.textures.isPowerOf2(a.width)&&tdl.textures.isPowerOf2(a.height):
tdl.textures.isPowerOf2(a.width/4)&&tdl.textures.isPowerOf2(a.height/3));a?(gl.generateMipmap(gl.TEXTURE_CUBE_MAP),this.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR)):this.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR)};tdl.textures.CubeMap.prototype.recoverFromLostContext=function(){tdl.textures.Texture.recoverFromLostContext.call(this);this.uploadTextures()};tdl.textures.CubeMap.prototype.updateTexture=function(a){this.faces[a].loaded=!0;this.loaded()&&this.uploadTextures()};
tdl.textures.CubeMap.prototype.bindToUnit=function(a){gl.activeTexture(gl.TEXTURE0+a);gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.texture)};var PerfHarness=function(a){var b={count:1,elapsedTime:0,targetFPS:50,targetTime:1,velocity:1,direction:1,frames:[]},c=[],d=0,e=0,f=0,g,h,k,l,m=function(){var a,b;window.performance&&(b=window.performance,a=window.performance.now||window.performance.webkitNow||window.performance.mozNow||window.performance.opNow);a||(b=Date,a=Date.now);return function(){return.001*a.call(b)}}(),n=function(){var a=m();b.elapsedTime=a-h;h=a;a=b.elapsedTime<b.targetTime?1:-1;b.direction!=a?(b.direction=a,b.velocity=Math.max(Math.abs(Math.floor(b.velocity/
4)),1)*b.direction,0>b.direction&&(f=3)):f?--f:b.velocity*=2;1E3>b.frames.length&&b.frames.push(b.elapsedTime);b.count+=b.velocity;b.count=Math.max(1,b.count);d-=c[e];d+=b.count;c[e]=b.count;e=(e+1)%g;k(b.count,Math.floor(d/g),b.elapsedTime);requestAnimationFrame(n,l)},p=function(a){b.targetFPS=a;b.targetTime=1/b.targetFPS};return{getTargetFPS:function(){return targetFPS},start:function(a,d,e,f){l=a;k=d;g=e||60;for(a=0;a<g;++a)c.push(0);!f&&b.targetTime||p(f||50);h=m();n()},setTargetFPS:p,g:b,endMarker:a}}();tdl.require("tdl.buffers");tdl.require("tdl.fast");tdl.require("tdl.fps");tdl.require("tdl.log");tdl.require("tdl.math");tdl.require("tdl.misc");tdl.require("tdl.models");tdl.require("tdl.primitives");tdl.require("tdl.programs");tdl.require("tdl.textures");tdl.require("tdl.webgl");window.onload=initialize;
var gl,canvas,math,fast,g_sortByModel=!1,g_eyeSpeed=.5,g_eyeHeight=2,g_eyeRadius=9,g_maxObjects=25E4,g_numObjects=100,g_modelsPerBlock=50,g_targetFrameRate=58,g_avgCounters=[],g_timeCounter=0,g_benchmarkDone=!1;
function CreateApp(){for(var a=tdl.primitives.createSphere(.4,6,6),b=tdl.primitives.createCube(.8),c=tdl.primitives.createTruncatedCone(.4,0,.8,12,1,!0,!0),d={diffuseSampler:tdl.textures.loadTexture("happy-face.png")},e=tdl.programs.loadProgramFromScriptTags("sphereVertexShader","sphereFragmentShader"),f=[new tdl.models.Model(e,a,d),new tdl.models.Model(e,b,d),new tdl.models.Model(e,c,d)],g=[],a=0;a<g_maxObjects;++a)g.push({x:0,y:0,z:0,colorMult:new Float32Array([Math.random(),Math.random(),Math.random(),
1]),modelIndex:Math.floor(a/g_modelsPerBlock)%f.length,xRadius:5*math.pseudoRandom(),yRadius:5*math.pseudoRandom(),zRadius:5*math.pseudoRandom(),xClockSpeed:math.pseudoRandom()+.5,yClockSpeed:math.pseudoRandom()+.5,zClockSpeed:math.pseudoRandom()+.5,xClock:math.pseudoRandom()*Math.PI*2,yClock:math.pseudoRandom()*Math.PI*2,zClock:math.pseudoRandom()*Math.PI*2});g_sortByModel&&g.sort(function(a,b){return a.modelIndex<b.modelIndex?-1:a.modelIndex>b.modelIndex?1:0});var h=new Float32Array(16),k=new Float32Array(16),
l=new Float32Array(16),m=new Float32Array(16),n=new Float32Array(16),p=new Float32Array(16),q=new Float32Array(16),t=new Float32Array(16),v=new Float32Array(16),r=new Float32Array(3),w=new Float32Array(3),u=new Float32Array([0,1,0]),x=new Float32Array(3),y=new Float32Array(3),z=new Float32Array(3),B=new Float32Array(3);new Float32Array(3);new Float32Array(16);new Float32Array(16);new Float32Array(16);new Float32Array(16);new Float32Array(4);var a=new Float32Array([1,1,1,1]),D={viewInverse:t,lightWorldPos:x,
specular:a,shininess:50,specularFactor:.2},C={colorMult:new Float32Array([0,0,0,1]),world:l,worldViewProjection:q,worldInverse:m,worldInverseTranspose:n},E=0;return{update:function(a){E+=a;resizeCanvas();r[0]=Math.sin(E*g_eyeSpeed)*g_eyeRadius;r[1]=g_eyeHeight;r[2]=Math.cos(E*g_eyeSpeed)*g_eyeRadius;a/=2;for(var b=0;b<g_numObjects;++b){var c=g[b];c.xClock+=a*c.xClockSpeed;c.yClock+=a*c.yClockSpeed;c.zClock+=a*c.zClockSpeed;c.x=Math.sin(c.xClock)*c.xRadius;c.y=Math.sin(c.yClock)*c.yRadius;c.z=Math.cos(c.zClock)*
c.zRadius}},render:function(){var a=fast.matrix4;gl.colorMask(!0,!0,!0,!0);gl.depthMask(!0);gl.clearColor(1,1,1,0);gl.clearDepth(1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);gl.enable(gl.CULL_FACE);gl.enable(gl.DEPTH_TEST);a.perspective(h,math.degToRad(60),canvas.clientWidth/canvas.clientHeight,1,5E3);a.lookAt(k,r,w,u);a.mul(p,k,h);a.inverse(t,k);a.inverse(v,p);a.getAxis(y,t,0);a.getAxis(z,t,1);a.getAxis(B,t,2);fast.mulScalarVector(y,10,y);fast.mulScalarVector(z,10,z);
fast.mulScalarVector(B,10,B);fast.addVector(x,r,y);fast.addVector(x,x,z);fast.addVector(x,x,B);for(var a=fast.matrix4,b=null,c=0;c<g_numObjects;++c){var d=g[c],e=f[d.modelIndex];e!=b&&(b=e,e.drawPrep(D));a.translation(l,[d.x,d.y,d.z]);a.mul(q,l,p);a.inverse(m,l);a.transpose(n,m);C.colorMult=d.colorMult;e.drawPrep();e.draw(C)}}}}
function round2Fixed(a){a=+a;if(isNaN(a))return NaN;a=a.toString().split("e");a=Math.round(+(a[0]+"e"+(a[1]?+a[1]+2:2)));a=a.toString().split("e");return(+(a[0]+"e"+(a[1]?+a[1]-2:-2))).toFixed(2)}function resizeCanvas(){if(canvas.width!=canvas.clientWidth||canvas.height!=canvas.clientHeight)canvas.width=canvas.clientWidth,canvas.height=canvas.clientHeight,gl.viewport(0,0,canvas.clientWidth,canvas.clientHeight)}
function initialize(){math=tdl.math;fast=tdl.fast;canvas=document.getElementById("canvas");var a=new tdl.fps.FPSTimer,b=document.getElementById("fps"),c=document.getElementById("cnt"),d=document.getElementById("avg"),e={alpha:!1,antialias:!1,preserveDrawingBuffer:!1};tdl.misc.applyUrlSettings(e);gl=tdl.webgl.setupWebGL(canvas,e);if(!gl)return!1;resizeCanvas();var f=CreateApp();PerfHarness.setTargetFPS(g_targetFrameRate);PerfHarness.start(canvas,function(e,h,k){a.update(k);b.innerHTML=a.averageFPS;
c.innerHTML=e;d.innerHTML=h;g_numObjects=e;if(!g_benchmarkDone&&(g_timeCounter+=k,10<g_timeCounter))if(20>g_timeCounter)g_avgCounters.push(h);else{h=Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(g_avgCounters)));var g=Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(g_avgCounters)));e=g_avgCounters.reduce(function(a,b,c,d){return a+b/d.length},0);h=(g-h)/e*100;console.log("js-WebGL x "+round2Fixed(e)+" average objects drawn \u00b1 "+round2Fixed(h)+"% ("+g_avgCounters.length+" runs sampled)");
g_benchmarkDone=!0}f.update(k);f.render()},60);return!0};
